<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Susana Inés Rodríguez Sanz">
<meta name="dcterms.date" content="2024-12-04">

<title>Estudio Piloto de la Expresión Alélica Específica a partir de datos de RNAseq y genotipado de SNPs en Trastorno Bipolar</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="viñeta_irs_files/libs/clipboard/clipboard.min.js"></script>
<script src="viñeta_irs_files/libs/quarto-html/quarto.js"></script>
<script src="viñeta_irs_files/libs/quarto-html/popper.min.js"></script>
<script src="viñeta_irs_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="viñeta_irs_files/libs/quarto-html/anchor.min.js"></script>
<link href="viñeta_irs_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="viñeta_irs_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="viñeta_irs_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="viñeta_irs_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="viñeta_irs_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Estudio Piloto de la Expresión Alélica Específica a partir de datos de RNAseq y genotipado de SNPs en Trastorno Bipolar</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Susana Inés Rodríguez Sanz </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 4, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introducción" class="level3">
<h3 class="anchored" data-anchor-id="introducción"><strong>Introducción</strong></h3>
<p>Esta viñeta tiene como finalidad describir y explicar los scripts desarrollados es este trabajo de fin de máster, en el que se analizan datos de RNA-seq y genotipado de individuos afectados y no afectados por el trastorno bipolar, con el objetivo de estudiar la expresión alélica específica.</p>
<p>La <strong>Figura 1</strong> resume los tipos de expresión alélica posibles, y también incluye una representación de cómo se cuantifica esta expresión alélica a partir de los datos empleados en este TFM, RNA-seq y genotipado.</p>
<p><img src="expresion.png" class="img-fluid" style="width:80.0%"></p>
<p><span style="font-size: 10px;"><strong>Figura 2.</strong> Patrones de expresión alélica específica. a) Expresión Balanceada: ambos alelos del gen se expresan por igual; b) Expresión Alélica Específica: un alelo muestra una mayor expresión en comparación con el otro; c) Expresión monoalélica: cuando solo se expresa una forma alélica. d) Cuantificación de la expresión alélica: se utilizan los datos de RNA-seq y los datos de SNPs heterocigotos para contar las lecturas alineadas de cada uno de los dos alelos.</span></p>
<p>El flujo de trabajo que se ha seguido se resume en la <strong>Figura 2</strong>:</p>
<p><img src="workflow.png" class="img-fluid" style="width:55.0%"></p>
<p><span style="font-size: 10px;"><strong>Figura 2.</strong> Flujo de trabajo empleado en el TFM. (1) Generación del VCF multimuestra con los datos de genotipado. (2) Control de calidad (FastQC) de los datos de RNA-seq, procesamiento y alineamiento al genoma de referencia. (3) Eliminación de las lecturas duplicadas y reducción del sesgo de mapeo. (4) Cálculo de los recuentos alélicos en sitios heterocigotos con AllelicImbalance. (5) Test binomial para detectar desequilibrio alélico en cada variante por individuo. (6) Cálculo de la proporción de expresión del alelo de referencia para cada individuo. Comparación de la distribución de proporciones entre los grupos mediante una prueba de suma de rangos de Wilcoxon. (7) Clasificación cualitativa de las variantes significativas (p &lt; 0.05) según el alelo que se expresa preferentemente (referencia o alternativo). Generación de tablas de contingencia con los patrones de preferencia alélica entre los grupos. Evaluación de la asociación entre el estado clínico y los patrones de preferencia alélica con el test exacto de Fisher. (8) Los genes con ASE diferencial pasan a un análisis de enriquecimiento funcional para revelar posibles vías implicadas.</span></p>
</section>
<section id="bloque-1-datos-de-partida" class="level3">
<h3 class="anchored" data-anchor-id="bloque-1-datos-de-partida"><strong>Bloque 1: datos de partida</strong></h3>
<p>En este estudio se ha partido de los datos de genotipado y RNA-seq de 10 individuos afectados por trastorno bipolar y 10 individuos sanos, manteniendo una proporción equitativa de hombres y mujeres en ambos grupos.</p>
<p><span style="font-size: 10px;"><strong>Tabla 1.</strong> Información de los individuos incluidos en el estudio. Se incluyen los identificadores anonimizados, el sexo y la condición: A) individuos sanos y B) individuos afectados por trastorno bipolar.</span></p>
<p><img src="individuos.png" class="img-fluid" style="width:65.0%"></p>
</section>
<section id="bloque-2-procesamiento-de-los-datos-bash" class="level3">
<h3 class="anchored" data-anchor-id="bloque-2-procesamiento-de-los-datos-bash"><strong>Bloque 2: procesamiento de los datos (bash)</strong></h3>
<section id="datos-de-genotipado" class="level4">
<h4 class="anchored" data-anchor-id="datos-de-genotipado"><strong>1. Datos de genotipado</strong></h4>
<section id="de-bfiles-a-vcf-plink" class="level5">
<h5 class="anchored" data-anchor-id="de-bfiles-a-vcf-plink"><strong>1.1. De bfiles a VCF (plink)</strong></h5>
<p>El código siguiente utiliza la herramienta PLINK para convertir archivos iniciales del genotipado, que están en formato .bim/.bed/.fam (bfiles), a formato .vcf (Variant Call Format, VCF), que ha sido necesario para los pasos siguientes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar el módulo de PLINK</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load plink</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir archivos bfiles a formato VCF</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">plink</span> <span class="at">--bfile</span> bfiles <span class="at">--recode</span> vcf <span class="at">--out</span> vcf_multi20</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vcfs-de-los-cromosomas-1-a-22-bcftools" class="level5">
<h5 class="anchored" data-anchor-id="vcfs-de-los-cromosomas-1-a-22-bcftools"><strong>1.2. VCFs de los cromosomas 1 a 22 (bcftools)</strong></h5>
<p>El archivo VCF resultante se comprime con bgzip, se indexa con tabix y luego se generan varios archivos VCF individuales, uno por cromosoma (1 al 22) usando bcftools.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprimir el archivo VCF inicial</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">bgzip</span> vcf_multi20_NamesOk.vcf</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar el índice para el archivo VCF comprimido</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">tabix</span> <span class="at">-p</span> vcf vcf_multi20_NamesOk.vcf.gz</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar un vcf para cada cromosoma (del 1 al 22) a partir del vcf.gz</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">22</span><span class="dt">}</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">bcftools</span> view <span class="at">-O</span> v <span class="at">-o</span> chr<span class="va">${i}</span>.vcf vcf_multi20_NamesOk.vcf.gz <span class="at">-r</span> <span class="va">${i}</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="datos-de-rna-seq" class="level4">
<h4 class="anchored" data-anchor-id="datos-de-rna-seq"><strong>2. Datos de RNA-seq</strong></h4>
<section id="control-de-calidad-fastqc" class="level5">
<h5 class="anchored" data-anchor-id="control-de-calidad-fastqc"><strong>2.1. Control de calidad (FastQC)</strong></h5>
<p>Se ha realizado un control de calidad inicial de las lecturas de la secuenciación de RNA con FastQC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load fastqc/0.11.9</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">fastqc</span> <span class="pp">*</span>/<span class="pp">*</span>.fq.gz <span class="at">-o</span> FASTQC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La calidad de las lecturas obtenidas ha sido alta, con valores de calidad de las bases muy superior a 30, sin secuencias sobrerrepresentadas ni un condenido de adaptadores significativo que requieran pasos adicionales para su eliminación.</p>
</section>
<section id="alineamiento-al-genoma-de-referencia-hisat2-y-samtools" class="level5">
<h5 class="anchored" data-anchor-id="alineamiento-al-genoma-de-referencia-hisat2-y-samtools"><strong>2.2. Alineamiento al genoma de referencia (hisat2 y Samtools)</strong></h5>
<p>Después, se alinean los datos de RNA-seq al genoma de referencia (hg38) utilizando hisat2, con la opción -k 1 para mantener solo la mejor alineación de cada lectura analizada. Esto asegura que hisat2 seleccione la alineación con el menor puntaje de error, descartando posibles alineaciones alternativas. Luego, el archivo de salida SAM se convierte a BAM usando Samtools, se ordena, se indexa y se eliminan los archivos intermedios SAM.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=4</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --ntasks-per-node=4</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=4</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load hisat2/2.1.0</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load samtools/1.9</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="va">index</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="va">forward</span><span class="op">=</span><span class="va">$2</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="va">reverse</span><span class="op">=</span><span class="va">$3</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Align each sample</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Starting with sample <span class="va">${index}</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="ex">hisat2</span> <span class="at">--rna-strandness</span> RF <span class="at">-k</span> 1 <span class="at">-p</span> 4 <span class="at">-x</span> /home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/fasta_index/hg38 <span class="at">-1</span> <span class="va">${forward}</span> <span class="at">-2</span> <span class="va">${reverse}</span> <span class="at">-S</span> <span class="va">${index}</span>.sam <span class="dv">2</span><span class="op">&gt;&gt;</span> summary_alignment_<span class="va">${index}</span>.txt</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Getting into samtools, sample <span class="va">${index}</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-@</span> 4 <span class="at">-bo</span> <span class="va">${index}</span>_notsorted.bam <span class="va">${index}</span>.sam</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Removing <span class="va">${index}</span>.sam</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">${index}</span>.sam</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Sorting <span class="va">${index}</span>_notsorted.bam</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> sort <span class="at">-@</span> 4 <span class="at">-o</span> <span class="va">${index}</span>.bam <span class="va">${index}</span>_notsorted.bam</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Indexing</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> index <span class="va">${index}</span>.bam</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Finishing with sample <span class="va">${index}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El código siguiente permite mandar varios trabajos al centro de computación científica de la UAM, para ejecutar el código anterior de forma automatizada para procesar los datos de las múltiples muestras de estudio. Para cada carpeta de muestra, busca los archivos forward y reverse, y si ambos existen, envía el trabajo de alineamiento a la cola del CC para ejecutar el script de alineamiento al genoma de referencia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejecutar el script de alineación para cada carpeta</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> carpeta <span class="kw">in</span> <span class="pp">*</span>/<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener el nombre de la carpeta (sin la barra diagonal final)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">sample_name</span><span class="op">=</span><span class="va">${carpeta</span><span class="op">%</span>/<span class="va">}</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Buscar el archivo forward que empiece por el nombre de la muestra y termine en _1.fq.gz</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">forward</span><span class="op">=</span><span class="va">$(</span><span class="fu">find</span> <span class="st">"</span><span class="va">$carpeta</span><span class="st">"</span> <span class="at">-name</span> <span class="st">"</span><span class="va">${sample_name}</span><span class="st">*_1.fq.gz"</span> <span class="at">-print</span> <span class="at">-quit</span><span class="va">)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Buscar el archivo reverse que empiece por el nombre de la muestra y termine en _2.fq.gz</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">reverse</span><span class="op">=</span><span class="va">$(</span><span class="fu">find</span> <span class="st">"</span><span class="va">$carpeta</span><span class="st">"</span> <span class="at">-name</span> <span class="st">"</span><span class="va">${sample_name}</span><span class="st">*_2.fq.gz"</span> <span class="at">-print</span> <span class="at">-quit</span><span class="va">)</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verificar si los archivos forward y reverse existen</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="ot">-f</span> <span class="st">"</span><span class="va">$forward</span><span class="st">"</span> <span class="kw">&amp;&amp;</span> <span class="ot">-f</span> <span class="st">"</span><span class="va">$reverse</span><span class="st">"</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Enviar el trabajo a la cola con los argumentos</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">sbatch</span> <span class="at">-A</span> genpsych_serv <span class="at">-p</span> bioinfo 1_alignment.sh <span class="st">"</span><span class="va">$sample_name</span><span class="st">"</span> <span class="st">"</span><span class="va">$forward</span><span class="st">"</span> <span class="st">"</span><span class="va">$reverse</span><span class="st">"</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">"Archivos no encontrados para la muestra: </span><span class="va">$sample_name</span><span class="st">"</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="eliminación-de-duplicados-samtools" class="level5">
<h5 class="anchored" data-anchor-id="eliminación-de-duplicados-samtools"><strong>2.3. Eliminación de duplicados (Samtools)</strong></h5>
<p>El fragmento siguiente de texto utiliza Samtools para procesar los archivos .bam crudos, eliminando los duplicados de forma aleatoria y generando un resumen de sus estadísticas asociadas. Los pasos principales que se realizan en este código son:</p>
<p><strong>1. Ordenar y procesar BAM:</strong> Los archivos .bam se ordenan por nombre de consulta (queryname), se utiliza fixmate ajustar la información de las lecturas pareadas, y luego se vuelven a ordenar por coordenadas.</p>
<p><strong>2. Eliminar duplicados:</strong> Utilizando markdup con la opción -r para eliminar duplicados aleatorios, generando un nuevo archivo BAM sin duplicados.</p>
<p><strong>3. Generar índices y estadísticas:</strong> Se genera el índice para cada archivos .bam sin duplicados y se obtienen estadísticas con flagstat para los archivos originales y los procesados.</p>
<p><strong>4. Limpieza:</strong> se eliminan los archivos intermedios no necesarios para conservar solo el archivo BAM final.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load samtools/1.16.1</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Directorios de entrada y salida</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="va">input_dir</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bams_1_iniciales"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="va">output_dir</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bams_2_nodup"</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el directorio de salida si no lo hemos creado previamente</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterar sobre cada archivo .bam en el directorio de entrada</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bam_file <span class="kw">in</span> <span class="st">"</span><span class="va">$input_dir</span><span class="st">"</span>/<span class="pp">*</span>.bam<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener el nombre base del archivo BAM sin la extensión .bam</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="va">base_name</span><span class="op">=</span><span class="va">$(</span><span class="fu">basename</span> <span class="st">"</span><span class="va">$bam_file</span><span class="st">"</span> .bam<span class="va">)</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Definir los nombres de los archivos intermedios y de salida</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="va">queryname_sorted_bam</span><span class="op">=</span><span class="st">"</span><span class="va">$output_dir</span><span class="st">/</span><span class="va">${base_name}</span><span class="st">_queryname_sorted.bam"</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="va">fixmate_bam</span><span class="op">=</span><span class="st">"</span><span class="va">$output_dir</span><span class="st">/</span><span class="va">${base_name}</span><span class="st">_fixmate.bam"</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="va">sorted_bam</span><span class="op">=</span><span class="st">"</span><span class="va">$output_dir</span><span class="st">/</span><span class="va">${base_name}</span><span class="st">_sorted.bam"</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="va">final_bam</span><span class="op">=</span><span class="st">"</span><span class="va">$output_dir</span><span class="st">/</span><span class="va">${base_name}</span><span class="st">_nodup.bam"</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Paso 1: Ordenar por nombre de consulta (queryname)</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Ordenando por nombre de consulta </span><span class="va">$bam_file</span><span class="st">"</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> sort <span class="at">-n</span> <span class="at">-o</span> <span class="st">"</span><span class="va">$queryname_sorted_bam</span><span class="st">"</span> <span class="st">"</span><span class="va">$bam_file</span><span class="st">"</span> <span class="dv">2</span><span class="op">&gt;&gt;</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">/sort_queryname_errors.log"</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Paso 2: Ejecutar samtools fixmate y registrar errores</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Ejecutando samtools fixmate para </span><span class="va">$queryname_sorted_bam</span><span class="st">"</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> fixmate <span class="at">-m</span> <span class="st">"</span><span class="va">$queryname_sorted_bam</span><span class="st">"</span> <span class="st">"</span><span class="va">$fixmate_bam</span><span class="st">"</span> <span class="dv">2</span><span class="op">&gt;&gt;</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">/fixmate_errors.log"</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Paso 3: Ejecutar samtools sort por coordenadas y registrar errores</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Ejecutando samtools sort por coordenadas para </span><span class="va">$fixmate_bam</span><span class="st">"</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> sort <span class="at">-o</span> <span class="st">"</span><span class="va">$sorted_bam</span><span class="st">"</span> <span class="st">"</span><span class="va">$fixmate_bam</span><span class="st">"</span> <span class="dv">2</span><span class="op">&gt;&gt;</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">/sort_errors.log"</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Paso 4: Ejecutar samtools markdup (con -r para "remove" aleatoriamente) y registrar errores</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Ejecutando samtools markdup para </span><span class="va">$sorted_bam</span><span class="st">"</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> markdup <span class="at">-r</span> <span class="st">"</span><span class="va">$sorted_bam</span><span class="st">"</span> <span class="st">"</span><span class="va">$final_bam</span><span class="st">"</span> <span class="dv">2</span><span class="op">&gt;&gt;</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">/markdup_errors.log"</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Paso 5: Generar el índice .bam.bai para el nuevo BAM sin duplicados</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Generando índice para </span><span class="va">$final_bam</span><span class="st">"</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> index <span class="st">"</span><span class="va">$final_bam</span><span class="st">"</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Paso 6: Generar estadísticas rápidas con flagstat para el BAM inicial</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Generando estadísticas iniciales con flagstat para </span><span class="va">$bam_file</span><span class="st">"</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> flagstat <span class="st">"</span><span class="va">$bam_file</span><span class="st">"</span> <span class="op">&gt;</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">/</span><span class="va">${base_name}</span><span class="st">_initial_flagstat.txt"</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Paso 7: Generar estadísticas rápidas con flagstat para el BAM sin duplicados</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Generando estadísticas con flagstat para </span><span class="va">$final_bam</span><span class="st">"</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> flagstat <span class="st">"</span><span class="va">$final_bam</span><span class="st">"</span> <span class="op">&gt;</span> <span class="st">"</span><span class="va">$output_dir</span><span class="st">/</span><span class="va">${base_name}</span><span class="st">_nodup_flagstat.txt"</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Limpiar archivos intermedios si no son necesarios</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="st">"</span><span class="va">$queryname_sorted_bam</span><span class="st">"</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="st">"</span><span class="va">$fixmate_bam</span><span class="st">"</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="st">"</span><span class="va">$sorted_bam</span><span class="st">"</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Proceso completado. Se pueden revisar los logs de errores y las estadísticas en la carpeta </span><span class="va">$output_dir</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="corrección-del-sesgo-de-mapeo-wasp" class="level5">
<h5 class="anchored" data-anchor-id="corrección-del-sesgo-de-mapeo-wasp"><strong>2.4. Corrección del sesgo de mapeo (WASP)</strong></h5>
<p>Para poder corregir el posible sesgo de mapeo en nuestros archivos .bams necesitamos preparar dos archivos .txt que necesitaremos a continuación. Por una parte, un archivo con el identificador de las muestras de estudio, y por otra parte, un archivo con información de los cromosomas a analizar, que se puede obtener del <em>USCS Genome Browser</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="pp">*</span>.bam <span class="kw">|</span> <span class="fu">sed</span> <span class="st">'s/\.bam//g'</span> <span class="op">&gt;</span> my_samples.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descargar del archivo chromInfo.txt de UCSC:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> http://hgdownload.soe.ucsc.edu/goldenPath/hg38/database/chromInfo.txt.gz</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gunzip</span> chromInfo.txt.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El siguiente paso es generar los archivos HDF5 a partir del los VCF de los 22 cromosomas. Los archivos HDF5 son tres (haplotypes.h5, snp_index.h5, y snp_tab.h5), y contienen la información de los haplotipos y los SNPs analizados. Para generar estos archivos se utilizan los siguientes parámetros:</p>
<ul>
<li><p>–chrom: apunta al archivo que contiene la información de los cromosomas (chr y longitud, descargado de USCS)</p></li>
<li><p>–format vcf: indica que el formato del archivo de entrada es VCF</p></li>
<li><p>–haplotype haplotypes.h5: archivo de salida que contendrá la información de haplotipos</p></li>
<li><p>–snp_index snp_index.h5: archivo de salida que contendrá el índice de SNPs</p></li>
<li><p>–snp_tab snp_tab.h5: nombre del archivo de salida que contendrá la tabla de SNPs</p></li>
<li><p>vcfs_samples/chr*.vcf: archivos VCF de entrada, uno por cada cromosoma, generados a partir del VCF.gz general</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generación del archivo HDF5 a partir de los VCF de los 22 cromosomas y el chromInfo.txt:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/local/wasp/0.3.4/snp2h5/snp2h5</span> <span class="at">--chrom</span> chromInfo_v2.txt <span class="dt">\</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">--format</span> vcf <span class="dt">\</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">--haplotype</span> haplotypes.h5 <span class="dt">\</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">--snp_index</span> snp_index.h5 <span class="dt">\</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">--snp_tab</span> snp_tab.h5 <span class="dt">\</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                vcfs_samples/chr<span class="pp">*</span>.vcf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación, se utiliza el script <em>find_intersecting_snps.py</em> de WASP para identificar lecturas que pueden tener sesgos de mapeo y que necesitan ser remapeadas, así como las lecturas que han alineado bien y no necesitan mapearse de nuevo. Este script se ejecuta para cada muestra de estudio y tiene los siguientes parámetros:</p>
<ul>
<li><p>–is_paired_end: indica que los datos de entrada son de lecturas emparejadas (paired-end)</p></li>
<li><p>–is_sorted: indica que los archivos .bam de entrada están ordenados por coordenadas</p></li>
<li><p>–output_dir: especifica el directorio de salida donde se guardan los resultados</p></li>
<li><p>–snp_tab, –snp_index, –haplotype: son los archivos HDF5 que contienen información sobre los SNPs y los haplotipos</p></li>
<li><p>–samples: el nombre de las muestras que se están procesando</p></li>
<li><p>BAM_DIR/${SAMPLE_NAME}_nodup.bam: El archivo .bam correspondiente a la muestra, donde ya se han eliminado los duplicados en los pasos anteriores</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=4</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --ntasks-per-node=4</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=4</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar módulos necesarios</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load python/3.7.7</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load samtools/1.9</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load hisat2/2.1.0</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load miniconda/3.7</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables de entrada</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="va">SNP_TAB</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/snp_tab.h5"</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="va">SNP_INDEX</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/snp_index.h5"</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="va">HAPLOTYPE</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/haplotypes.h5"</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="va">OUTPUT_DIR</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bams_3_wasp"</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el directorio de salida si no existe</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">${OUTPUT_DIR}</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Archivo que contiene la lista de muestras</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="va">SAMPLES_FILE</span><span class="op">=</span><span class="st">"my_samples.txt"</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Directorio donde están los BAMs</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="va">BAM_DIR</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bams_2_nodup"</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">###################################################################################</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Bloque 1:</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Iniciando Bloque 1"</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterar sobre cada muestra</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">read</span> <span class="va">SAMPLE_NAME</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Identificando lecturas que pueden tener sesgos de mapeo para la muestra </span><span class="va">${SAMPLE_NAME}</span><span class="st">..."</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ejecutar el script find_intersecting_snps.py para cada muestra</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="ex">python</span> /usr/local/wasp/0.3.4/mapping/find_intersecting_snps.py <span class="dt">\</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>           <span class="at">--is_paired_end</span> <span class="dt">\</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">--is_sorted</span> <span class="dt">\</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>           <span class="at">--output_dir</span> <span class="va">${OUTPUT_DIR}</span> <span class="dt">\</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">--snp_tab</span> <span class="va">${SNP_TAB}</span> <span class="dt">\</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">--snp_index</span> <span class="va">${SNP_INDEX}</span> <span class="dt">\</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>           <span class="at">--haplotype</span> <span class="va">${HAPLOTYPE}</span> <span class="dt">\</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">--samples</span> <span class="va">${SAMPLE_NAME}</span> <span class="dt">\</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>           <span class="va">${BAM_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_nodup.bam  <span class="co"># El archivo BAM de entrada</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Finalizando identificación de SNPs para la muestra </span><span class="va">${SAMPLE_NAME}</span><span class="st">."</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&lt;</span> <span class="va">${SAMPLES_FILE}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una vez idenficadas las lecturas que necesitan mapearse de nuevo, se utiliza el remapeo de estas lecturas con la misma herramienta que utilizamos anteriormente, hitsat2. De nuevo, los alineamientos se convierten a formato .bam, y luego se ordenan e indexan con Samtools, obteniendo un archivo .bam final con las lecturas que se han remapeado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar módulos necesarios</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load samtools/1.9</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load hisat2/2.1.0</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables de entrada</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="va">SNP_TAB</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/snp_tab.h5"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="va">SNP_INDEX</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/snp_index.h5"</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="va">HAPLOTYPE</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/haplotypes.h5"</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="va">OUTPUT_DIR</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bams_3_wasp"</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Remapeo de lecturas con potencial sesgo de mapeo</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> remap_fq1 <span class="kw">in</span> <span class="va">${OUTPUT_DIR}</span>/<span class="pp">*</span>.remap.fq1.gz<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraer el nombre de la muestra del nombre del archivo</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="va">SAMPLE_NAME</span><span class="op">=</span><span class="va">$(</span><span class="fu">basename</span> <span class="va">${remap_fq1}</span> .remap.fq1.gz<span class="va">)</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Nombre de la muestra </span><span class="va">${SAMPLE_NAME}</span><span class="st"> extraído con éxito."</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Especificar el archivo de lectura emparejada</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="va">remap_fq2</span><span class="op">=</span><span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>.remap.fq2.gz</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Remapeando lecturas para la muestra </span><span class="va">${SAMPLE_NAME}</span><span class="st">..."</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ejecutar hisat2 para remapear las lecturas emparejadas</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">hisat2</span> <span class="at">--rna-strandness</span> RF <span class="at">-k</span> 1 <span class="at">-p</span> 4 <span class="at">-x</span> /home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/fasta_index/hg38 <span class="dt">\</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">-1</span> <span class="va">${remap_fq1}</span> <span class="dt">\</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">-2</span> <span class="va">${remap_fq2}</span> <span class="dt">\</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">-S</span> <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_remap.sam <span class="dv">2</span><span class="op">&gt;&gt;</span> summary_remapping_<span class="va">${SAMPLE_NAME}</span>.txt</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Convirtiendo </span><span class="va">${SAMPLE_NAME}</span><span class="st">_remap.sam a BAM..."</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convertir a BAM</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> view <span class="at">-@</span> 4 <span class="at">-bo</span> <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_remap_notsorted.bam <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_remap.sam</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Eliminando </span><span class="va">${SAMPLE_NAME}</span><span class="st">_remap.sam"</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_remap.sam</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Ordenando </span><span class="va">${SAMPLE_NAME}</span><span class="st">_remap_notsorted.bam..."</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> sort <span class="at">-@</span> 4 <span class="at">-o</span> <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_remap.bam <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_remap_notsorted.bam</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Indexando </span><span class="va">${SAMPLE_NAME}</span><span class="st">_remap.bam..."</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> index <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_remap.bam</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Finalizando remapeo de lecturas para la muestra </span><span class="va">${SAMPLE_NAME}</span><span class="st">."</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A partir de los archivos .bam con las lecturas remapeadas, se realiza el filtrado de estas lecturas, de forma que si han alineado en el mismo sitio, se consevan, y si no, se descartan. Para ello se ejecuta el script de WASP <em>filter_remapped_reads.py</em>. Este script necesita tres archivos .bam de entrada: el archivo con lecturas que deben ser remapeadas (to_remap_bam), el archivo con las lecturas remapeadas (remap_bam), y el archivo donde se almacenarán las lecturas que se deben mantener después del filtrado (keep_bam). El filtrado se realiza para cada muestra de forma secuencial.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=4</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --ntasks-per-node=4</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=4</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar módulos necesarios</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load samtools/1.9</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load hisat2/2.1.0</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load miniconda/3.7</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables de entrada</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="va">SNP_TAB</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/snp_tab.h5"</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="va">SNP_INDEX</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/snp_index.h5"</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="va">HAPLOTYPE</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/haplotypes.h5"</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="va">OUTPUT_DIR</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bams_3_wasp"</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Archivo que contiene la lista de muestras</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="va">SAMPLES_FILE</span><span class="op">=</span><span class="st">"my_samples.txt"</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar lecturas remapeadas</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">read</span> <span class="va">SAMPLE_NAME</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Filtrando lecturas remapeadas para la muestra </span><span class="va">${SAMPLE_NAME}</span><span class="st">..."</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Especificar los archivos de entrada y salida</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="va">to_remap_bam</span><span class="op">=</span><span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_nodup.to.remap.bam</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="va">remap_bam</span><span class="op">=</span><span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_nodup_remap.bam</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="va">keep_bam</span><span class="op">=</span><span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_nodup.remap.keep.bam</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ejecutar el script de filtrado</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="ex">python</span> /usr/local/wasp/0.3.4/mapping/filter_remapped_reads.py <span class="dt">\</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>           <span class="va">${to_remap_bam}</span> <span class="dt">\</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>           <span class="va">${remap_bam}</span> <span class="dt">\</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>           <span class="va">${keep_bam}</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Finalizando filtrado de lecturas remapeadas para la muestra </span><span class="va">${SAMPLE_NAME}</span><span class="st">."</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="op">&lt;</span> <span class="va">${SAMPLES_FILE}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finalmente, se utiliza samtools merge para fusionar los archivos .bam que contienen las lecturas que se deben conservar de cada muestra, es decir, el archivo de lecturas originales y el archivo de lecturas remapeadas en un único archivo .bam para cada muestra analizada (_keep.merge.bam).</p>
<p>Además, se ordena el archivo fusionado utilizando samtools sort, generando un archivo ordenado (_keep.merge.sort.bam); y se elimina el archivo .bam fusionado no ordenado para ahorrar espacio en disco.</p>
<p>Finalmente, se indexa el archivo .bam ordenado con samtools index para facilitar el acceso rápido a las posiciones de las lecturas en los pasos siguientes del estudio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=4</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --ntasks-per-node=4</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=4</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar módulos necesarios</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load samtools/1.9</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load hisat2/2.1.0</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load miniconda/3.9</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables de entrada</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="va">SNP_TAB</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/snp_tab.h5"</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="va">SNP_INDEX</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/snp_index.h5"</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="va">HAPLOTYPE</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bfiles_y_vcf/HDF5_files/haplotypes.h5"</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="va">OUTPUT_DIR</span><span class="op">=</span><span class="st">"/home/irs16/genpsych_acc_directo/BIOBANK/RNASEQ/TFM_InesSus_RNAseq/bams_3_wasp"</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Archivo que contiene la lista de muestras</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="va">SAMPLES_FILE</span><span class="op">=</span><span class="st">"my_samples.txt"</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso final: Fusionar, ordenar e indexar los BAMs filtrados</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> SAMPLE_NAME <span class="kw">in</span> <span class="va">$(</span><span class="fu">cat</span> <span class="va">${SAMPLES_FILE})</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Fusionando BAMs para la muestra </span><span class="va">${SAMPLE_NAME}</span><span class="st">..."</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fusionar los archivos BAM filtrados</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> merge <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_nodup.keep.merge.bam <span class="dt">\</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>                   <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_nodup.keep.bam <span class="dt">\</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>                   <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_nodup.remap.keep.bam </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Ordenando el archivo fusionado </span><span class="va">${SAMPLE_NAME}</span><span class="st">_nodup.keep.merge.bam..."</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ordenar el archivo BAM fusionado</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> sort <span class="at">-o</span> <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_nodup.keep.merge.sort.bam <span class="dt">\</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>                  <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_nodup.keep.merge.bam</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Eliminar el archivo intermedio no ordenado</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_nodup.keep.merge.bam</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Indexando el archivo ordenado </span><span class="va">${SAMPLE_NAME}</span><span class="st">_nodup.keep.merge.sort.bam..."</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Indexar el archivo BAM ordenado</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">samtools</span> index <span class="va">${OUTPUT_DIR}</span>/<span class="va">${SAMPLE_NAME}</span>_nodup.keep.merge.sort.bam</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Finalizado el proceso para la muestra </span><span class="va">${SAMPLE_NAME}</span><span class="st">."</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Finalizado con éxito."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una vez realizados estos pasos de procesado de los archivos .bam se pueden sacar tablas y gráficos que resuman el número de lecturas que se utilizan en cada paso de filtrado, para así poder evaluar el rendimiento de estas estrategias. En este TFM hemos representado estos resultados en boxplots, como se ve en la siguiente figura: <img src="boxplots.png" class="img-fluid" style="width:75.0%"></p>
<p><span style="font-size: 10px;"> <strong>Figura 3.</strong> Distribución del número de lecturas de RNA-seq por paso de procesamiento y condición clínica. Se muestran tres etapas: lecturas crudas, tras la eliminación de duplicados y tras la corrección del sesgo de mapeo. </span></p>
</section>
</section>
</section>
<section id="bloque-3-análisis-de-expresión-alélica-específica-allelicimbalance-r" class="level3">
<h3 class="anchored" data-anchor-id="bloque-3-análisis-de-expresión-alélica-específica-allelicimbalance-r"><strong>Bloque 3:</strong> análisis de expresión alélica específica (AllelicImbalance, R)</h3>
<section id="obtención-de-recuentos-y-análisis-de-ase" class="level4">
<h4 class="anchored" data-anchor-id="obtención-de-recuentos-y-análisis-de-ase"><strong>1. Obtención de recuentos y análisis de ASE</strong></h4>
<p>En el siguiente script se utiliza el paquete <em>AllelicImbalance</em> para realizar el análisis de expresión alélica específica (ASE). A partir de los archivos .bams y el vcf multimuestra generados previamente, se realiza un filtrado de las variantes, para descartar la información de aquellas que son heterocigotas o tienen pocas lecturas. También se aplican pruebas estadísticas para identificar posibles desequilibrios alélicos asociados con el trastorno bipolar. El análisis se enfoca en comparar individuos afectados y no afectados (casos <em>vs</em> controles).</p>
<p>Primero, instalamos y cargamos los paquetes necesarios en R. Entre los paquetes utilizados se encuentran <em>AllelicImbalance</em>, <em>VariantAnnotation</em> y <em>GenomicAlignments</em>, fundamentales para procesar y analizar datos de secuenciación genómica y de RNA-Seq. Se definen también los directorios de trabajo y las rutas de acceso a los archivos de entrada, que incluyen archivos .vcf (con información de variantes genéticas), archivos .bam (con lecturas alineadas de RNA-Seq) y un excel (.xlxs) con datos fenotípicos sobre las muestras, que en nuestro caso es el estado afectado o no afectado por trastorno bipolar de los individuos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/irs_tfm"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="do">### 1. Instalar los paquetes necesarios (AllelicImbalance y VariantAnnotation)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"BiocManager"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"BiocManager"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="fu">c</span>(<span class="st">"AllelicImbalance"</span>, <span class="st">"VariantAnnotation"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"GenomicAlignments"</span>, <span class="st">"SNPlocs.Hsapiens.dbSNP144.GRCh38"</span>))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"readxl"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"biomaRt"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"biomaRt"</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalar dplyr si aún no lo tienes</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"dplyr"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar AllelicImbalance, VariantAnnotation y otros paquetes necesarios</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AllelicImbalance)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VariantAnnotation)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GenomicAlignments)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SNPlocs.Hsapiens.dbSNP144.GRCh38)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(biomaRt)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="do">### 2. Rutas a los archivos necesarios:</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir la ruta al archivo VCF (VCF multisample)</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>pathToVcf <span class="ot">&lt;-</span> <span class="st">"C:/irs_tfm/vcf_multi.vcf"</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir el directorio donde se encuentran los BAMs </span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>pathToFiles <span class="ot">&lt;-</span> <span class="st">"X:/ASE_irs/bams_ase"</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Se carga el excel con los fenotipos de los individuos (affected vs unaffected)</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>fenotipo <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"C:/irs_tfm/fenotipo_cond.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En el siguiente paso, se lee el archivo .vcf multimuestra con la función <em>readVcf()</em> del paquete <em>VariantAnnotation.</em> Una vez cargadas las variantes, se aplica un filtrado para conservar únicamente aquellas que son bialélicas, es decir, que presentan un alelo de referencia y un solo alelo alternativo, lo que facilita el análisis de expresión alélica específica. Después, el objeto VCF se convierte en un objeto <em>GRanges</em>, necesario para trabajar con el paquete <strong>AllelicImbalance</strong> de <em>Bioconductor</em>, que permite acceder de manera eficiente a la información de las variantes analizadas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">### 3. Leer el archivo VCF (VCF: info de todos los individuos) y lo filtramos</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>VCF_raw <span class="ot">&lt;-</span> <span class="fu">readVcf</span>(pathToVcf, <span class="st">"hg38"</span>) </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminamos los posibles duplicados y el archivo con duplicados para liberar espacio</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>VCF <span class="ot">&lt;-</span> <span class="fu">unique</span>(VCF_raw)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(VCF_raw)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Archivo VCF cargado exitosamente.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir el VCF en un objeto GRanges</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">&lt;-</span> <span class="fu">granges</span>(VCF)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrado: quedarnos solo con las variantes bialélicas (Alelos: 1 REF y 1 ALT)</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>gr.filt <span class="ot">&lt;-</span> gr[<span class="fu">width</span>(<span class="fu">mcols</span>(gr)[,<span class="st">"REF"</span>]) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sapply</span>(<span class="fu">mcols</span>(gr)[,<span class="st">"ALT"</span>], <span class="cf">function</span>(alt) <span class="fu">length</span>(alt) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!</span><span class="fu">is.na</span>(alt) <span class="sc">&amp;&amp;</span> <span class="fu">nchar</span>(alt) <span class="sc">&gt;</span> <span class="dv">0</span>)]</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(gr.filt, <span class="at">file =</span> <span class="st">"gr.filt.RData"</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Filtrado completado: se han retenido solo variantes bialélicas.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar directamente los primeros 22 niveles de gr.filt_chr (chr 1 al 22)</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>gr.filt <span class="ot">&lt;-</span> <span class="fu">keepSeqlevels</span>(gr.filt, <span class="fu">seqlevels</span>(gr.filt)[<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>], <span class="at">pruning.mode =</span> <span class="st">"coarse"</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar variantes bialélicas: REF de longitud 1 y ALT con exactamente un alelo</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprobar si todas las variantes son bialélicas (en todas las posiciones)</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>biallelic_check <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">mcols</span>(gr.filt)<span class="sc">$</span>ALT, <span class="cf">function</span>(alt) <span class="fu">length</span>(alt) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>result_bialelic_check <span class="ot">&lt;-</span> <span class="fu">sum</span>(biallelic_check) <span class="sc">==</span> <span class="fu">length</span>(gr.filt) </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Verificación de variantes bialélicas completada: "</span>, result_bialelic_check, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Debería salir TRUE. Sí, sale TRUE</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardar el resultado en un txt</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(result_bialelic_check, <span class="at">file =</span> <span class="st">"result_bialelic_check.Rdata"</span>)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Función readGT: permite leer la info de fase del archivo VCF de partida</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>geno_fullVCF <span class="ot">&lt;-</span> <span class="fu">geno</span>(VCF)<span class="sc">$</span>GT</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(geno_fullVCF, <span class="at">file =</span> <span class="st">"geno_fullVCF.Rdata"</span>)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Información genotípica del VCF leida correctamente. </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación, se genera un bucle iterativo de análisis, en el que se analiza secuencialmente la información de los 22 cromosomas autosómicos, permitiendo optimizar el uso de memoria y organizar los resultados de manera estructurada. Los pasos principales de este apartado son:</p>
<p><strong>1) Definición de tamaños cromosómicos:</strong> Primero, se definen las longitudes de los cromosomas autosómicos (hg38), necesarias para establecer rangos de búsqueda en las lecturas de RNA-seq.</p>
<p><strong>2) Iteración sobre cromosomas:</strong> El bucle <em>for</em> itera a través de cada cromosoma, creando un entorno específico para el análisis individual:</p>
<ul>
<li><p><strong>Filtrado de variantes:</strong> se seleccionan las variantes del cromosoma actual (<em>gr.filt_chr</em>) a partir de un conjunto de datos filtrado previamente (<em>gr.filt</em>). Se eliminan duplicados y se mantiene solo la información de los cromosomas 1 a 22.</p></li>
<li><p><strong>Carga de lecturas de RNA-seq:</strong> utilizando la función <em>impBamGAL</em>, se extraen las lecturas correspondientes al cromosoma actual. Se ajustan las longitudes cromosómicas para garantizar la coherencia entre .bams y variantes.</p></li>
<li><p><strong>Recuento de alelos:</strong> la función <em>getAlleleCounts</em> calcula los conteos alélicos para las posiciones de interés. Se guardan estos datos y se eliminan las lecturas .bams el ambiente de R para liberar memoria.</p></li>
</ul>
<p><strong>3) Filtrado de recuentos alélicos:</strong> Se aplica un proceso de filtrado para cada posición. Se descartan los recuentos totales inferiores a 10 y se eliminan los recuentos de los individuos homocigotos para cada variante. Posteriormente, se genera un objeto <em>ASEset</em> que incorpora la información de fase de las variantes.</p>
<p><strong>4) Optimización y filtrado final:</strong> Las variantes con recuentos completamente nulos )=0) se descartan, y se crea un objeto <em>ASEset</em> definitivo con las variantes y recuentos filtrados. La información de fase se añade nuevamente, garantizando que solo se consideren variantes heterocigotas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="do">### 4. Trabajo con un solo cromosoma en cada iteración:</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir los tamaños de los cromosomas humanos (autosómicos) (versión hg38)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>chr_sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">248956422</span>, <span class="dv">242193529</span>, <span class="dv">198295559</span>, <span class="dv">190214555</span>, <span class="dv">181538259</span>, </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>               <span class="dv">170805979</span>, <span class="dv">159345973</span>, <span class="dv">145138636</span>, <span class="dv">138394717</span>, <span class="dv">133797422</span>, </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>               <span class="dv">135086622</span>, <span class="dv">133275309</span>, <span class="dv">114364328</span>, <span class="dv">107043718</span>, <span class="dv">101991189</span>, </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>               <span class="dv">90338345</span>, <span class="dv">83257441</span>, <span class="dv">80373285</span>, <span class="dv">58617616</span>, <span class="dv">64444167</span>, </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>               <span class="dv">46709983</span>, <span class="dv">50818468</span>) <span class="co">#Se sacan de SNPlocs.Hsapiens.dbSNP144.GRCh38</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un bucle que itere a través de los cromosomas 1 al 22 (autosómicos)</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (chr <span class="cf">in</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Definir el nombre del cromosoma actual y la longitud del cromosoma</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  chr_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"chr"</span>, chr)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  chr_length <span class="ot">&lt;-</span> chr_sizes[chr]</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear un directorio específico para guardar los resultados del chr actual</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  result_dir <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"resultados_"</span>, chr_name) <span class="co"># Directorio para guardar resultados</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(result_dir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Informar de que el proceso ha comenzado para el cromosoma actual</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Iniciando análisis para "</span>, chr_name, <span class="st">"...</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.1. Filtrar variantes del cromosoma estudiado del gr o vcf total</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  gr.filt_chr <span class="ot">&lt;-</span> gr.filt[<span class="fu">seqnames</span>(gr.filt) <span class="sc">==</span> <span class="fu">c</span>(chr)]</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Eliminamos los posibles duplicados</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  gr.filt_chr <span class="ot">&lt;-</span> gr.filt_chr[<span class="sc">!</span><span class="fu">duplicated</span>(gr.filt_chr)]</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">###### ###### ###### ###### ###### ###### ###### ###### ###### ###### ###### ######</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtrar para conservar solo los cromosomas 1 al 22 en el objeto gr_filt_chr</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  chromosomes_to_keep <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"chr"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>)  <span class="co"># Lista de los cromosomas del 1 al 22</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear un nuevo objeto con solo estos cromosomas</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  gr.filt_chr <span class="ot">&lt;-</span> <span class="fu">keepSeqlevels</span>(gr.filt_chr, <span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>, <span class="at">pruning.mode =</span> <span class="st">"coarse"</span>)</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>  <span class="do">###### ###### ###### ###### ###### ###### ###### ###### ###### ###### ###### ######</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Comprobar cuántas variantes quedan tras el filtrado</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  n_var_chr <span class="ot">&lt;-</span> <span class="fu">length</span>(gr.filt_chr)</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guardar nº de variantes por chr</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(n_var_chr, <span class="at">file =</span> <span class="fu">paste0</span>(result_dir, <span class="st">"/n_var_"</span>, chr_name, <span class="st">".RData"</span>))</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Información en consola:</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Número de variantes en "</span>, chr_name, <span class="st">": "</span>, <span class="fu">length</span>(gr.filt_chr), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.2. Filtrar los BAMs para sacar la información del cromosoma estudiado</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Establecer el área de búsqueda para el cromosoma concreto</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>  searchArea_chr <span class="ot">&lt;-</span> <span class="fu">GRanges</span>(<span class="at">seqnames =</span> <span class="fu">c</span>(chr),</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ranges =</span> <span class="fu">IRanges</span>(<span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> (chr_length)))</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cargar la información del RNAseq del cromosoma estudiado (reads = lecturas de los BAMs)</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>  reads_chr <span class="ot">&lt;-</span> <span class="fu">impBamGAL</span>(pathToFiles, searchArea_chr, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Lecturas del cromosoma "</span>, chr_name, <span class="st">" cargadas exitosamente.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mantener solo los primeros 22 cromosomas en reads_chr</span></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>  reads_chr <span class="ot">&lt;-</span> <span class="fu">keepSeqlevels</span>(reads_chr, <span class="fu">seqlevels</span>(reads_chr)[<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>], <span class="at">pruning.mode =</span> <span class="st">"coarse"</span>)</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ajustamos la longitud de los cromosomas para que coincidan entre bams y vcf</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seqlengths</span>(gr.filt_chr)[<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>] <span class="ot">&lt;-</span> <span class="fu">seqlengths</span>(reads_chr)</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.3. Recuento de los alelos que hay en las reads para las posiciones filtradas </span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>  countList_chr <span class="ot">&lt;-</span> <span class="fu">getAlleleCounts</span>(reads_chr, gr.filt_chr, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Recuento de alelos realizado para el cromosoma "</span>, chr_name, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mostrar el resultado (solo una parte inicial con head)</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(countList_chr))</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guardar los recuentos resultantes (iniciales o crudos)</span></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(countList_chr, <span class="at">file =</span> <span class="fu">paste0</span>(result_dir, <span class="st">"/countList_"</span>, chr_name, <span class="st">".RData"</span>))</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Recuendos alélicos del cromosoma "</span>, chr_name, <span class="st">" guardados con éxito .</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Eliminamos las lecturas de los bams para reducir la carga en memoria</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(reads_chr)</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Lecturas de los bams eliminadas del enviroment con éxito."</span>)</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.4. Filtrado de los recuentos a partir de la countList</span></span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inicializa una lista para almacenar los resultados filtrados</span></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>  filtered_countList_chr <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Itera sobre cada posición en countList</span></span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (pos <span class="cf">in</span> <span class="fu">names</span>(countList_chr)) {</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extrae los conteos de la posición actual</span></span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>    counts <span class="ot">&lt;-</span> countList_chr[[pos]]</span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Itera sobre cada fila (cada persona) para verificar los totales</span></span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(counts)) {</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>      total_counts <span class="ot">&lt;-</span> <span class="fu">sum</span>(counts[i, ])  <span class="co"># Suma de lecturas para esa persona</span></span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Si el total es menor que 10, establece toda la fila a 0</span></span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (total_counts <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>        counts[i, ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"Fila "</span>, i, <span class="st">" establecida a 0 para variante "</span>, pos, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>    filtered_countList_chr[[pos]] <span class="ot">&lt;-</span> counts</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># }</span></span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mostrar el resultado del filtrado de los recuentos</span></span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Filtrado de recuentos completado para el cromosoma "</span>, chr, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(filtered_countList_chr))</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.5. Crear el objeto ASEset inicial a partir de la lista de conteos filtrada</span></span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>  ase_chr <span class="ot">&lt;-</span> <span class="fu">ASEsetFromCountList</span>(<span class="at">rowRanges =</span> gr.filt_chr,</span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>                                   filtered_countList_chr)</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Objeto ASEset inicial creado para el cromosoma "</span>, chr,<span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.6. Añadir información de fase (genotipo: homocigotos o heterocigotos)</span></span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Info de GT se ha extraido previamente para todas las posiciones del VCF con:</span></span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a>        <span class="co"># geno_fullVCF &lt;- geno(VCF)$GT</span></span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer las posiciones de gr.filt_chr</span></span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>  positions_chr <span class="ot">&lt;-</span> <span class="fu">start</span>(gr.filt_chr)</span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtrar el VCF para las variantes del cromosoma usando las posiciones extraídas</span></span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>  filt_indices_chr <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">seqnames</span>(VCF) <span class="sc">==</span> chr <span class="sc">&amp;</span></span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">start</span>(<span class="fu">granges</span>(VCF)) <span class="sc">%in%</span> positions_chr)</span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer la información de genotipos solo para las variantes filtradas</span></span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a>  geno_chr_filt <span class="ot">&lt;-</span> geno_fullVCF[filt_indices_chr,]</span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajustar la información de fase a las dimensiones de `ase_chr` automáticamente</span></span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a>  required_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(ase_chr)  <span class="co"># Número de filas necesario basado en `ase_chr`</span></span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>  geno_chr_filt_adjusted <span class="ot">&lt;-</span> geno_chr_filt[<span class="dv">1</span><span class="sc">:</span>required_rows, ]  <span class="co"># Ajustar filas</span></span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Confirmar dimensiones antes de asignar</span></span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Dimensiones de geno_chr_filt_adjusted:"</span>, <span class="fu">dim</span>(geno_chr_filt_adjusted), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Dimensiones de ase_chr:"</span>, <span class="fu">dim</span>(ase_chr), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asignar la información de fase al objeto ASEset inicial</span></span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">phase</span>(ase_chr) <span class="ot">&lt;-</span> geno_chr_filt_adjusted</span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Checkear el funcionamiento con:</span></span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Información de fase añadida a ASEset inicial para el cromosoma "</span>, chr, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(<span class="fu">phase</span>(ase_chr)))</span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.7. Filtrado de Heterocigotos y Recuentos = 0</span></span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Generación del objeto ASEset definitivo</span></span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fase (phase information) y recuentos (allele counts)</span></span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a>  phase_info_chr <span class="ot">&lt;-</span> <span class="fu">phase</span>(ase_chr)</span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Primer bucle: Poner a 0 los recuentos si son homocigotos o NA</span></span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterar sobre cada variante en la lista de recuentos</span></span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (variante <span class="cf">in</span> <span class="fu">names</span>(filtered_countList_chr)) {</span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recorrer cada individuo en la fase y recuentos</span></span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (individuo <span class="cf">in</span> <span class="fu">colnames</span>(phase_info_chr)) {</span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Si el individuo es homocigoto ("0/0", "1/1", "0|0", "1|1") o NA</span></span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (phase_info_chr[variante, individuo] <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0/0"</span>, <span class="st">"1/1"</span>, <span class="st">"0|0"</span>, <span class="st">"1|1"</span>, <span class="st">"./."</span>)</span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a>          <span class="sc">||</span> <span class="fu">is.na</span>(phase_info_chr[variante, individuo])) {</span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Poner a 0 todos los recuentos para esa variante y ese individuo</span></span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a>        filtered_countList_chr[[variante]][individuo, ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>      <span class="co"># En caso contrario, es decir, si el individuo es heterocigoto</span></span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a>      <span class="co"># ("0/1", "1/0", "0|1", "1|0"), no hacemos nada (los recuentos se mantienen)</span></span>
<span id="cb16-172"><a href="#cb16-172" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-173"><a href="#cb16-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(chr_name, <span class="st">"Variante:"</span>, variante, <span class="st">"Recuentos de homocigotos = 0.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-174"><a href="#cb16-174" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-175"><a href="#cb16-175" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-176"><a href="#cb16-176" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Segundo bucle: Verificar si todos los recuentos son 0 y eliminar variantes si es necesario</span></span>
<span id="cb16-177"><a href="#cb16-177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-178"><a href="#cb16-178" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear una lista para almacenar las variantes eliminadas y conservadas</span></span>
<span id="cb16-179"><a href="#cb16-179" aria-hidden="true" tabindex="-1"></a>  var_delete_chr <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-180"><a href="#cb16-180" aria-hidden="true" tabindex="-1"></a>  filtered_countList_chr_def <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-181"><a href="#cb16-181" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-182"><a href="#cb16-182" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (variante <span class="cf">in</span> <span class="fu">names</span>(filtered_countList_chr)) {</span>
<span id="cb16-183"><a href="#cb16-183" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-184"><a href="#cb16-184" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraer los recuentos para la variante actual</span></span>
<span id="cb16-185"><a href="#cb16-185" aria-hidden="true" tabindex="-1"></a>    counts <span class="ot">&lt;-</span> filtered_countList_chr[[variante]]</span>
<span id="cb16-186"><a href="#cb16-186" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-187"><a href="#cb16-187" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verificamos si todos los valores son 0 para todas las personas</span></span>
<span id="cb16-188"><a href="#cb16-188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">all</span>(counts <span class="sc">==</span> <span class="dv">0</span>)) {</span>
<span id="cb16-189"><a href="#cb16-189" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Si todos son ceros, añadimos esta variante a la lista de eliminadas</span></span>
<span id="cb16-190"><a href="#cb16-190" aria-hidden="true" tabindex="-1"></a>      var_delete_chr <span class="ot">&lt;-</span> <span class="fu">c</span>(var_delete_chr, variante)</span>
<span id="cb16-191"><a href="#cb16-191" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb16-192"><a href="#cb16-192" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Si no todos son ceros, añade esta posición a la lista filtrada</span></span>
<span id="cb16-193"><a href="#cb16-193" aria-hidden="true" tabindex="-1"></a>      filtered_countList_chr_def[[variante]] <span class="ot">&lt;-</span> counts</span>
<span id="cb16-194"><a href="#cb16-194" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-195"><a href="#cb16-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Eliminada la variante "</span>,variante,<span class="st">"por recuentos = 0 del"</span>, chr_name,<span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-196"><a href="#cb16-196" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-197"><a href="#cb16-197" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-198"><a href="#cb16-198" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer solo las posiciones numéricas de las variantes eliminadas</span></span>
<span id="cb16-199"><a href="#cb16-199" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asumiendo que los nombres son del formato "chrn_posicion"</span></span>
<span id="cb16-200"><a href="#cb16-200" aria-hidden="true" tabindex="-1"></a>  pos_delete_chr <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">".*_"</span>, <span class="st">""</span>, var_delete_chr))</span>
<span id="cb16-201"><a href="#cb16-201" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-202"><a href="#cb16-202" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-203"><a href="#cb16-203" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtrar el objeto GRanges eliminando las variantes en las posiciones indicadas</span></span>
<span id="cb16-204"><a href="#cb16-204" aria-hidden="true" tabindex="-1"></a>  gr.filt_chr_def <span class="ot">&lt;-</span> gr.filt_chr[<span class="sc">!</span><span class="fu">start</span>(gr.filt_chr)</span>
<span id="cb16-205"><a href="#cb16-205" aria-hidden="true" tabindex="-1"></a>                                     <span class="sc">%in%</span> pos_delete_chr]</span>
<span id="cb16-206"><a href="#cb16-206" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-207"><a href="#cb16-207" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-208"><a href="#cb16-208" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guardar los recuentos resutlantes</span></span>
<span id="cb16-209"><a href="#cb16-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(filtered_countList_chr, <span class="at">file =</span> <span class="fu">paste0</span>(result_dir, <span class="st">"/filtered_countList_chr"</span></span>
<span id="cb16-210"><a href="#cb16-210" aria-hidden="true" tabindex="-1"></a>                                             , chr, <span class="st">".RData"</span>))</span>
<span id="cb16-211"><a href="#cb16-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Recuentos filtrados del cromosoma"</span>, chr, <span class="st">" guardados correctamente.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-212"><a href="#cb16-212" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-213"><a href="#cb16-213" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-214"><a href="#cb16-214" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.8. Crear el objeto ASEset definitivo</span></span>
<span id="cb16-215"><a href="#cb16-215" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (con los recuentos filtrados previamente, en dos pasos anteriores)</span></span>
<span id="cb16-216"><a href="#cb16-216" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-217"><a href="#cb16-217" aria-hidden="true" tabindex="-1"></a>  ase_chr_def <span class="ot">&lt;-</span> <span class="fu">ASEsetFromCountList</span>(<span class="at">rowRanges =</span> gr.filt_chr_def,</span>
<span id="cb16-218"><a href="#cb16-218" aria-hidden="true" tabindex="-1"></a>                                   filtered_countList_chr_def)</span>
<span id="cb16-219"><a href="#cb16-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Objeto ASEset creado para el "</span>, chr_name, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-220"><a href="#cb16-220" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-221"><a href="#cb16-221" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadir la información de fase al objeto ASEset definitivo</span></span>
<span id="cb16-222"><a href="#cb16-222" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Solo miramos las variantes que han pasado los filtros previos</span></span>
<span id="cb16-223"><a href="#cb16-223" aria-hidden="true" tabindex="-1"></a>  positions_def_chr <span class="ot">&lt;-</span> <span class="fu">start</span>(gr.filt_chr_def)</span>
<span id="cb16-224"><a href="#cb16-224" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-225"><a href="#cb16-225" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtrar el VCF para las variantes del cromosoma usando las posiciones extraídas</span></span>
<span id="cb16-226"><a href="#cb16-226" aria-hidden="true" tabindex="-1"></a>  phase_indices_chr <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">seqnames</span>(VCF) <span class="sc">==</span> chr <span class="sc">&amp;</span></span>
<span id="cb16-227"><a href="#cb16-227" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">start</span>(<span class="fu">granges</span>(VCF)) <span class="sc">%in%</span> positions_def_chr)</span>
<span id="cb16-228"><a href="#cb16-228" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-229"><a href="#cb16-229" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer la información de genotipos solo para las variantes filtradas</span></span>
<span id="cb16-230"><a href="#cb16-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">phase</span>(ase_chr_def) <span class="ot">&lt;-</span> geno_fullVCF[phase_indices_chr, ]</span>
<span id="cb16-231"><a href="#cb16-231" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-232"><a href="#cb16-232" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-233"><a href="#cb16-233" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.9. INFORMACIÓN FENOTÍPICA:</span></span>
<span id="cb16-234"><a href="#cb16-234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-235"><a href="#cb16-235" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cargar el archivo Excel en R y transformarlo a Data Frame</span></span>
<span id="cb16-236"><a href="#cb16-236" aria-hidden="true" tabindex="-1"></a>  feno_data <span class="ot">&lt;-</span> <span class="fu">DataFrame</span>(<span class="at">Condition =</span> fenotipo<span class="sc">$</span>Condition)</span>
<span id="cb16-237"><a href="#cb16-237" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-238"><a href="#cb16-238" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadir el identificador de las muestras al Data Frame anterior</span></span>
<span id="cb16-239"><a href="#cb16-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(feno_data) <span class="ot">&lt;-</span> fenotipo<span class="sc">$</span>Sample</span>
<span id="cb16-240"><a href="#cb16-240" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-241"><a href="#cb16-241" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Incluir el fenotipo en el objeto ASEset</span></span>
<span id="cb16-242"><a href="#cb16-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colData</span>(ase_chr_def) <span class="ot">&lt;-</span> feno_data</span>
<span id="cb16-243"><a href="#cb16-243" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-244"><a href="#cb16-244" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Para poder checkear que se ha cargado bien podemos utilizar:</span></span>
<span id="cb16-245"><a href="#cb16-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Información fenotípica añadida con éxito para el"</span>, chr_name,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-246"><a href="#cb16-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(<span class="fu">colData</span>(ase_chr_def)))</span>
<span id="cb16-247"><a href="#cb16-247" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-248"><a href="#cb16-248" aria-hidden="true" tabindex="-1"></a>  <span class="co"># O también para un individuo concreto:</span></span>
<span id="cb16-249"><a href="#cb16-249" aria-hidden="true" tabindex="-1"></a>  <span class="co"># colData(ase_chr_def)["identificador_individuo.bam", "Condition"]</span></span>
<span id="cb16-250"><a href="#cb16-250" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-251"><a href="#cb16-251" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-252"><a href="#cb16-252" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.10. INFO REF Y ALT ALLELES</span></span>
<span id="cb16-253"><a href="#cb16-253" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-254"><a href="#cb16-254" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer los alelos de referencia desde la columna REF del gr.filt correspondiente</span></span>
<span id="cb16-255"><a href="#cb16-255" aria-hidden="true" tabindex="-1"></a>  ref_alleles_chr <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">mcols</span>(gr.filt_chr_def)[, <span class="st">"REF"</span>])</span>
<span id="cb16-256"><a href="#cb16-256" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-257"><a href="#cb16-257" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer los alelos alternativos desde la columna ALT del gr.filt correspondiente</span></span>
<span id="cb16-258"><a href="#cb16-258" aria-hidden="true" tabindex="-1"></a>  alt_alleles_chr <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">mcols</span>(gr.filt_chr_def)<span class="sc">$</span>ALT, <span class="cf">function</span>(x) <span class="fu">as.character</span>(x))</span>
<span id="cb16-259"><a href="#cb16-259" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-260"><a href="#cb16-260" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Se extraen los alelos REF y ALT de forma distinta porque se almacenan de forma distinta en gr.filt:</span></span>
<span id="cb16-261"><a href="#cb16-261" aria-hidden="true" tabindex="-1"></a>  <span class="co"># DNAStringSet (REF): Se puede convertir directamente a caracteres.</span></span>
<span id="cb16-262"><a href="#cb16-262" aria-hidden="true" tabindex="-1"></a>  <span class="co"># DNAStringSetList (ALT): Se debe extraer cada elemento antes de convertir.</span></span>
<span id="cb16-263"><a href="#cb16-263" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-264"><a href="#cb16-264" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verificar los alelos de referencia extraídos</span></span>
<span id="cb16-265"><a href="#cb16-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(ref_alleles_chr))</span>
<span id="cb16-266"><a href="#cb16-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(alt_alleles_chr))</span>
<span id="cb16-267"><a href="#cb16-267" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-268"><a href="#cb16-268" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asignar estos alelos de referencia y alternativo objeto ASEset</span></span>
<span id="cb16-269"><a href="#cb16-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ref</span>(ase_chr_def) <span class="ot">&lt;-</span> ref_alleles_chr</span>
<span id="cb16-270"><a href="#cb16-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alt</span>(ase_chr_def) <span class="ot">&lt;-</span> alt_alleles_chr</span>
<span id="cb16-271"><a href="#cb16-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Información Ref y Alt alleles añadida con éxito para el"</span>, chr_name, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-272"><a href="#cb16-272" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-273"><a href="#cb16-273" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verificar la asignación</span></span>
<span id="cb16-274"><a href="#cb16-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Alelo de referencia y alternativo asignado en ASEset:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-275"><a href="#cb16-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(<span class="fu">ref</span>(ase_chr_def)))</span>
<span id="cb16-276"><a href="#cb16-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(<span class="fu">alt</span>(ase_chr_def)))</span>
<span id="cb16-277"><a href="#cb16-277" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-278"><a href="#cb16-278" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-279"><a href="#cb16-279" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.11. INFO GENOTYPE</span></span>
<span id="cb16-280"><a href="#cb16-280" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-281"><a href="#cb16-281" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inferir los genotipos y añadirlos en el campo correspondiente del objeto ASEset</span></span>
<span id="cb16-282"><a href="#cb16-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">genotype</span>(ase_chr_def) <span class="ot">&lt;-</span> <span class="fu">inferGenotypes</span>(ase_chr_def)</span>
<span id="cb16-283"><a href="#cb16-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Información genotípica añadida con éxito para el"</span>, chr_name, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-284"><a href="#cb16-284" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-285"><a href="#cb16-285" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-286"><a href="#cb16-286" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.12. Check Mapping Bias (average reference allele fraction)</span></span>
<span id="cb16-287"><a href="#cb16-287" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-288"><a href="#cb16-288" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sacar la fracción del alelo de referencia</span></span>
<span id="cb16-289"><a href="#cb16-289" aria-hidden="true" tabindex="-1"></a>  refFrac_chr <span class="ot">&lt;-</span> <span class="fu">fraction</span>(ase_chr_def, <span class="at">top.fraction.criteria=</span><span class="st">"ref"</span>)</span>
<span id="cb16-290"><a href="#cb16-290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-291"><a href="#cb16-291" aria-hidden="true" tabindex="-1"></a>  <span class="co"># obtener la media</span></span>
<span id="cb16-292"><a href="#cb16-292" aria-hidden="true" tabindex="-1"></a>  refFrac_mean_chr <span class="ot">&lt;-</span> <span class="fu">mean</span>(refFrac_chr, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-293"><a href="#cb16-293" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-294"><a href="#cb16-294" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Imprimir el resultado:</span></span>
<span id="cb16-295"><a href="#cb16-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Fracción media del alelo de referencia:"</span>, refFrac_mean_chr, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-296"><a href="#cb16-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(refFrac_mean_chr, <span class="at">file =</span> <span class="fu">paste0</span>(result_dir, <span class="st">"/refFrac_mean_"</span>, chr_name, <span class="st">".RData"</span>))</span>
<span id="cb16-297"><a href="#cb16-297" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-298"><a href="#cb16-298" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################</span></span>
<span id="cb16-299"><a href="#cb16-299" aria-hidden="true" tabindex="-1"></a>  <span class="do">### 4.13. Análisis estadístico y Filtrado por significación estadística</span></span>
<span id="cb16-300"><a href="#cb16-300" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-301"><a href="#cb16-301" aria-hidden="true" tabindex="-1"></a>  <span class="co"># guardar el objeto ASE set definitivo antes de continuar</span></span>
<span id="cb16-302"><a href="#cb16-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(ase_chr_def, <span class="at">file =</span> <span class="fu">paste0</span>(result_dir, <span class="st">"/ase_chr_def_"</span>, chr, <span class="st">".RData"</span>))</span>
<span id="cb16-303"><a href="#cb16-303" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-304"><a href="#cb16-304" aria-hidden="true" tabindex="-1"></a>  <span class="do">######################     ######################     ######################   </span></span>
<span id="cb16-305"><a href="#cb16-305" aria-hidden="true" tabindex="-1"></a>      <span class="do">##### Test Binomial (AllelicImbalance-Bioconductor):</span></span>
<span id="cb16-306"><a href="#cb16-306" aria-hidden="true" tabindex="-1"></a>  <span class="do">######################     ######################     ###################### </span></span>
<span id="cb16-307"><a href="#cb16-307" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-308"><a href="#cb16-308" aria-hidden="true" tabindex="-1"></a>  binom_results_chr <span class="ot">&lt;-</span> <span class="fu">binom.test</span>(ase_chr_def, <span class="at">n =</span> <span class="st">'*'</span>)</span>
<span id="cb16-309"><a href="#cb16-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Test binomial realizado con éxito para el "</span>, chr_name, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-310"><a href="#cb16-310" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-311"><a href="#cb16-311" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creamos un objeto para almacenar los resutlados significativos</span></span>
<span id="cb16-312"><a href="#cb16-312" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos NaN por NA para facilitar el manejo de esta información</span></span>
<span id="cb16-313"><a href="#cb16-313" aria-hidden="true" tabindex="-1"></a>  binom_results_chr[binom_results_chr <span class="sc">==</span> <span class="st">"NaN"</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb16-314"><a href="#cb16-314" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-315"><a href="#cb16-315" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convierte el resultado a un dataframe</span></span>
<span id="cb16-316"><a href="#cb16-316" aria-hidden="true" tabindex="-1"></a>  binom_df_chr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(binom_results_chr)</span>
<span id="cb16-317"><a href="#cb16-317" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-318"><a href="#cb16-318" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crea un dataframe vacío para almacenar los resultados significativos</span></span>
<span id="cb16-319"><a href="#cb16-319" aria-hidden="true" tabindex="-1"></a>  signif_df_chr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">ncol</span>(binom_df_chr), <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb16-320"><a href="#cb16-320" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-321"><a href="#cb16-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(signif_df_chr) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(binom_df_chr)</span>
<span id="cb16-322"><a href="#cb16-322" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-323"><a href="#cb16-323" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inicializar una lista para almacenar las variantes significativas</span></span>
<span id="cb16-324"><a href="#cb16-324" aria-hidden="true" tabindex="-1"></a>  binom_sig_variants_chr <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-325"><a href="#cb16-325" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-326"><a href="#cb16-326" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bucle para analizar las filas y columnas</span></span>
<span id="cb16-327"><a href="#cb16-327" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(binom_df_chr)) {</span>
<span id="cb16-328"><a href="#cb16-328" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(binom_df_chr)) {</span>
<span id="cb16-329"><a href="#cb16-329" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(binom_df_chr[i, j]) <span class="sc">&amp;&amp;</span> binom_df_chr[i, j] <span class="sc">&lt;=</span> <span class="fl">0.05</span>) {</span>
<span id="cb16-330"><a href="#cb16-330" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Almacena el valor significativo en el nuevo dataframe</span></span>
<span id="cb16-331"><a href="#cb16-331" aria-hidden="true" tabindex="-1"></a>        signif_df_chr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(signif_df_chr, <span class="fu">data.frame</span>(<span class="at">Sample =</span> <span class="fu">rownames</span>(binom_df_chr)[i],</span>
<span id="cb16-332"><a href="#cb16-332" aria-hidden="true" tabindex="-1"></a>                                                           <span class="at">Variant =</span> <span class="fu">colnames</span>(binom_df_chr)[j],</span>
<span id="cb16-333"><a href="#cb16-333" aria-hidden="true" tabindex="-1"></a>                                                           <span class="at">Value =</span> binom_df_chr[i, j],</span>
<span id="cb16-334"><a href="#cb16-334" aria-hidden="true" tabindex="-1"></a>                                                           <span class="at">Test =</span> <span class="st">"Binomial"</span>))</span>
<span id="cb16-335"><a href="#cb16-335" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Añadir el nombre de la variante significativa a la lista</span></span>
<span id="cb16-336"><a href="#cb16-336" aria-hidden="true" tabindex="-1"></a>        binom_sig_variants_chr <span class="ot">&lt;-</span> <span class="fu">c</span>(binom_sig_variants_chr, <span class="fu">colnames</span>(binom_df_chr)[j])</span>
<span id="cb16-337"><a href="#cb16-337" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-338"><a href="#cb16-338" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-339"><a href="#cb16-339" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-340"><a href="#cb16-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Variantes significativas extraídas con éxito para el"</span>, chr_name, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-341"><a href="#cb16-341" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-342"><a href="#cb16-342" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verifica si no se han encontrado resultados significativos</span></span>
<span id="cb16-343"><a href="#cb16-343" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(signif_df_chr) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb16-344"><a href="#cb16-344" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Si no hay resultados significativos, dejar el dataframe vacío</span></span>
<span id="cb16-345"><a href="#cb16-345" aria-hidden="true" tabindex="-1"></a>    signif_df_chr <span class="ot">&lt;-</span> <span class="fu">signif_df_chr</span>(<span class="at">Sample =</span> <span class="fu">character</span>(),</span>
<span id="cb16-346"><a href="#cb16-346" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Variant =</span> <span class="fu">character</span>(),</span>
<span id="cb16-347"><a href="#cb16-347" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Value =</span> <span class="fu">numeric</span>(),</span>
<span id="cb16-348"><a href="#cb16-348" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Test =</span> <span class="fu">character</span>(),</span>
<span id="cb16-349"><a href="#cb16-349" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Strand =</span> <span class="fu">character</span>(),</span>
<span id="cb16-350"><a href="#cb16-350" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-351"><a href="#cb16-351" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-352"><a href="#cb16-352" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"No hay variantes significativas en el test binomial del "</span>, chr_name, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-353"><a href="#cb16-353" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-354"><a href="#cb16-354" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-355"><a href="#cb16-355" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Imprimir el dataframe de resultados significativos</span></span>
<span id="cb16-356"><a href="#cb16-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(signif_df_chr))</span>
<span id="cb16-357"><a href="#cb16-357" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-358"><a href="#cb16-358" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guardar los resultados del análsis estadístico</span></span>
<span id="cb16-359"><a href="#cb16-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(signif_df_chr, <span class="at">file =</span> <span class="fu">paste0</span>(result_dir, <span class="st">"/signif_df_"</span>, chr_name, <span class="st">".RData"</span>))</span>
<span id="cb16-360"><a href="#cb16-360" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-361"><a href="#cb16-361" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guardar el número de variantes significativas con este test estadístico</span></span>
<span id="cb16-362"><a href="#cb16-362" aria-hidden="true" tabindex="-1"></a>  num_var_binom_chr <span class="ot">&lt;-</span> <span class="fu">nrow</span>(signif_df_chr)</span>
<span id="cb16-363"><a href="#cb16-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(num_var_binom_chr, <span class="at">file =</span> <span class="fu">paste0</span>(result_dir, <span class="st">"/num_var_binom_"</span>, chr_name, <span class="st">".RData"</span>))</span>
<span id="cb16-364"><a href="#cb16-364" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-365"><a href="#cb16-365" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guardar los nombres de las variantes únicas significativas del test estadístico</span></span>
<span id="cb16-366"><a href="#cb16-366" aria-hidden="true" tabindex="-1"></a>  unique_binom_sig_var_chr <span class="ot">&lt;-</span> <span class="fu">unique</span>(binom_sig_variants_chr)</span>
<span id="cb16-367"><a href="#cb16-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(unique_binom_sig_var_chr, <span class="at">file =</span> <span class="fu">paste0</span>(result_dir, <span class="st">"/unique_binom_sig_var_"</span>, chr_name, <span class="st">".RData"</span>))</span>
<span id="cb16-368"><a href="#cb16-368" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-369"><a href="#cb16-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Información del test binomial del "</span>, chr_name,<span class="st">" guardado con éxito.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-370"><a href="#cb16-370" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-371"><a href="#cb16-371" aria-hidden="true" tabindex="-1"></a>  <span class="do">#########################################################################################</span></span>
<span id="cb16-372"><a href="#cb16-372" aria-hidden="true" tabindex="-1"></a>  <span class="do">#########################################################################################</span></span>
<span id="cb16-373"><a href="#cb16-373" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4.14. IDENTIFICADOR DE LAS VARIANTES CONOCIDAS (identificador rs conocido)</span></span>
<span id="cb16-374"><a href="#cb16-374" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-375"><a href="#cb16-375" aria-hidden="true" tabindex="-1"></a>  <span class="do">### SOLUCIÓN: solo con binom.test:</span></span>
<span id="cb16-376"><a href="#cb16-376" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-377"><a href="#cb16-377" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtrar el objeto rowRanges del ASEset para quedarnos solo con las variantes comunes significativas</span></span>
<span id="cb16-378"><a href="#cb16-378" aria-hidden="true" tabindex="-1"></a>  filtered_gr_chr <span class="ot">&lt;-</span> <span class="fu">rowRanges</span>(ase_chr_def)[<span class="fu">names</span>(<span class="fu">rowRanges</span>(ase_chr_def)) </span>
<span id="cb16-379"><a href="#cb16-379" aria-hidden="true" tabindex="-1"></a>                                                <span class="sc">%in%</span> unique_binom_sig_var_chr]</span>
<span id="cb16-380"><a href="#cb16-380" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-381"><a href="#cb16-381" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Confirmamos que las longitudes de los cromosomas coincidan:</span></span>
<span id="cb16-382"><a href="#cb16-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seqlengths</span>(filtered_gr_chr)[<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>] <span class="ot">&lt;-</span> <span class="fu">seqlengths</span>(SNPlocs.Hsapiens.dbSNP144.GRCh38)[<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>]</span>
<span id="cb16-383"><a href="#cb16-383" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-384"><a href="#cb16-384" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos las localizaciones por el rs </span></span>
<span id="cb16-385"><a href="#cb16-385" aria-hidden="true" tabindex="-1"></a>  rs_signif_var_chr <span class="ot">&lt;-</span> <span class="fu">getSnpIdFromLocation</span>(filtered_gr_chr, SNPlocs.Hsapiens.dbSNP144.GRCh38)</span>
<span id="cb16-386"><a href="#cb16-386" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-387"><a href="#cb16-387" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Creo un nuevo objeto ASEset solo con la información de las posiciones significativas</span></span>
<span id="cb16-388"><a href="#cb16-388" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-389"><a href="#cb16-389" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identificar las posiciones que están tanto en ase_chr_def como en filtered_gr_chr</span></span>
<span id="cb16-390"><a href="#cb16-390" aria-hidden="true" tabindex="-1"></a>  pos_to_keep_chr <span class="ot">&lt;-</span> <span class="fu">which</span>((<span class="fu">rownames</span>(ase_chr_def)) <span class="sc">%in%</span> unique_binom_sig_var_chr)</span>
<span id="cb16-391"><a href="#cb16-391" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-392"><a href="#cb16-392" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtrar el ASEset original para quedarse solo con las posiciones de interés</span></span>
<span id="cb16-393"><a href="#cb16-393" aria-hidden="true" tabindex="-1"></a>  ase_chr_def_v2 <span class="ot">&lt;-</span> ase_chr_def[pos_to_keep_chr, ]</span>
<span id="cb16-394"><a href="#cb16-394" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-395"><a href="#cb16-395" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Podemos añadir estos rs al objeto ASEset para utilziarlos en los gráficos posteriores</span></span>
<span id="cb16-396"><a href="#cb16-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowRanges</span>(ase_chr_def_v2) <span class="ot">&lt;-</span> rs_signif_var_chr</span>
<span id="cb16-397"><a href="#cb16-397" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-398"><a href="#cb16-398" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer los rs conocidos en una lista</span></span>
<span id="cb16-399"><a href="#cb16-399" aria-hidden="true" tabindex="-1"></a>  rs_known_list_chr <span class="ot">&lt;-</span> <span class="fu">names</span>(rs_signif_var_chr[<span class="sc">!</span><span class="fu">grepl</span>(chr_name,<span class="st">"_"</span>, <span class="fu">names</span>(rs_signif_var_chr))])</span>
<span id="cb16-400"><a href="#cb16-400" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-401"><a href="#cb16-401" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guardamos el objeto resultante</span></span>
<span id="cb16-402"><a href="#cb16-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(rs_known_list_chr, <span class="at">file =</span> <span class="fu">paste0</span>(result_dir, <span class="st">"/rs_known_list_"</span>, chr_name,<span class="st">".RData"</span>))</span>
<span id="cb16-403"><a href="#cb16-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Identificadores rs del cromosoma"</span>, chr, <span class="st">"guardados con éxito.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-404"><a href="#cb16-404" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-405"><a href="#cb16-405" aria-hidden="true" tabindex="-1"></a>  <span class="do">#########################################################################################</span></span>
<span id="cb16-406"><a href="#cb16-406" aria-hidden="true" tabindex="-1"></a>  <span class="do">#########################################################################################</span></span>
<span id="cb16-407"><a href="#cb16-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-408"><a href="#cb16-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">" ##########################################</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb16-409"><a href="#cb16-409" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Análisis completado para "</span>, chr_name,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb16-410"><a href="#cb16-410" aria-hidden="true" tabindex="-1"></a>      <span class="st">"##########################################</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-411"><a href="#cb16-411" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-412"><a href="#cb16-412" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Limpiar el entorno dejando solo los archivos necesarios para la siguiente iteración</span></span>
<span id="cb16-413"><a href="#cb16-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">"gr.filt"</span>, <span class="st">"geno_fullVCF"</span>, <span class="st">"pathToFiles"</span>,</span>
<span id="cb16-414"><a href="#cb16-414" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"fenotipo"</span>, <span class="st">"chr_sizes"</span>, <span class="st">"VCF"</span>, <span class="st">"chr"</span>)))</span>
<span id="cb16-415"><a href="#cb16-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Limpieza del enviroment del cromosoma"</span>, chr, <span class="st">" realizada con éxito.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-416"><a href="#cb16-416" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-417"><a href="#cb16-417" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una vez generados estos datos, podemos generar tablas que nos permitan reunir la distribución de estas variantes en los 22 cromosomas y en los distintos pasos de filtrado realizados, como por ejemplo:</p>
<p><img src="n_var.png" class="img-fluid" style="width:75.0%"></p>
<p><span style="font-size: 10px;"><strong>Tabla 2.</strong> Distribución de variantes por cromosoma en las diferentes etapas del filtrado. Se incluye información de las variantes iniciales, las variantes filtradas en los objetos ASEset y aquellas que han superado el test binomial.</span></p>
<p>Para generar la tabla anterior, que combina la información de los 22 cromosomas en los distintos pasos del analisis, se ha utilizado el código siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar las librerías necesarias</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(biomaRt)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># TABLA 1: Número de variantes por cromosoma</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="do">### 1. Crear la tabla vacía donde se van a almacenar los resultados:</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cromosoma =</span> <span class="fu">c</span>(<span class="st">"1_1"</span>, <span class="st">"1_2"</span>, <span class="st">"2_1"</span>, <span class="st">"2_2"</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">22</span>),</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variantes_totales =</span> <span class="fu">integer</span>(<span class="dv">24</span>),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variantes_tras_filtrar =</span> <span class="fu">integer</span>(<span class="dv">24</span>),</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variantes_signif_binom_test =</span> <span class="fu">integer</span>(<span class="dv">24</span>),</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">RefFrac_mean =</span> <span class="fu">numeric</span>(<span class="dv">24</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="do">### 2. Extraer la información relevante de los objetos correspondientes:</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Establecer el directorio principal donde están las carpetas de los cromosomas</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>main_dir <span class="ot">&lt;-</span> <span class="st">"C:/Users/inesu/Desktop/TFM/RESULTADOS"</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (chr <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"1_1"</span>, <span class="st">"1_2"</span>, <span class="st">"2_1"</span>, <span class="st">"2_2"</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">22</span>)) {</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Construir el nombre de la subcarpeta para el cromosoma actual</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  subfolder <span class="ot">&lt;-</span> <span class="fu">file.path</span>(main_dir, <span class="fu">paste0</span>(<span class="st">"resultados_chr"</span>, chr))</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiar al directorio de la subcarpeta</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setwd</span>(subfolder)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determinar el número del cromosoma base (sin el sufijo de mitad)</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>  chr_num <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(chr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1_1"</span>, <span class="st">"1_2"</span>), <span class="st">"1"</span>, </span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ifelse</span>(chr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2_1"</span>, <span class="st">"2_2"</span>), <span class="st">"2"</span>, <span class="fu">as.character</span>(chr)))</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generar los nombres de los archivos a cargar</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>  countList_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"countList_chr"</span>, chr_num, <span class="st">".RData"</span>)</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>  ase_chr_def_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"ase_chr_def_"</span>, chr_num, <span class="st">".RData"</span>)</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  unique_binom_sig_var_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"unique_binom_sig_var_chr"</span>, chr_num, <span class="st">".RData"</span>)</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>  refFrac_mean_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"refFrac_mean_chr"</span>, chr_num, <span class="st">".RData"</span>)</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cargar los archivos necesarios</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(countList_file)            <span class="co"># Carga countList</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(ase_chr_def_file)          <span class="co"># Carga ase_chr_def</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(unique_binom_sig_var_file) <span class="co"># Carga unique_binom_sig_var_chr</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(refFrac_mean_file)         <span class="co"># Carga refFrac_mean_chr</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asignar valores a la tabla para el cromosoma actual</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>  summary_table<span class="sc">$</span>Variantes_totales[summary_table<span class="sc">$</span>Cromosoma <span class="sc">==</span> chr] <span class="ot">&lt;-</span> <span class="fu">length</span>(countList_chr)</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>  summary_table<span class="sc">$</span>Variantes_tras_filtrar[summary_table<span class="sc">$</span>Cromosoma <span class="sc">==</span> chr] <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">seqnames</span>(<span class="fu">rowRanges</span>(ase_chr_def)))</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>  summary_table<span class="sc">$</span>Variantes_signif_binom_test[summary_table<span class="sc">$</span>Cromosoma <span class="sc">==</span> chr] <span class="ot">&lt;-</span> <span class="fu">length</span>(unique_binom_sig_var_chr)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>  summary_table<span class="sc">$</span>RefFrac_mean[summary_table<span class="sc">$</span>Cromosoma <span class="sc">==</span> chr] <span class="ot">&lt;-</span> refFrac_mean_chr</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Volver al directorio principal</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setwd</span>(main_dir)</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Imprimir la tabla completa por mitades</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_table)</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a><span class="do">### 3. Generar una tabla con los resultados por cromosomas del 1 al 22:</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una copia de la tabla y combinar las mitades para los cromosomas 1 y 2</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>summary_table_combined <span class="ot">&lt;-</span> summary_table <span class="sc">%&gt;%</span></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cromosoma =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>    Cromosoma <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1_1"</span>, <span class="st">"1_2"</span>) <span class="sc">~</span> <span class="st">"1"</span>,  <span class="co"># Combinar las filas de 1_1 y 1_2 en "1"</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>    Cromosoma <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2_1"</span>, <span class="st">"2_2"</span>) <span class="sc">~</span> <span class="st">"2"</span>,  <span class="co"># Combinar las filas de 2_1 y 2_2 en "2"</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(Cromosoma)</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar por Cromosoma y calcular la suma y la media de las fracciones de alelo de referencia</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>summary_table_combined <span class="ot">&lt;-</span> summary_table_combined <span class="sc">%&gt;%</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Cromosoma) <span class="sc">%&gt;%</span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variantes_totales =</span> <span class="fu">sum</span>(Variantes_totales),</span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variantes_tras_filtrar =</span> <span class="fu">sum</span>(Variantes_tras_filtrar),</span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variantes_signif_binom_test =</span> <span class="fu">sum</span>(Variantes_signif_binom_test),</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">RefFrac_mean =</span> <span class="fu">mean</span>(RefFrac_mean),</span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">as.numeric</span>(Cromosoma))</span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Imprimir la tabla combinada</span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_table_combined)</span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a><span class="do">### 4. Guardar las tablas:</span></span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardar la tabla completa como archivo CSV</span></span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(summary_table, <span class="st">"summary_table.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardar la tabla combinada como archivo CSV</span></span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(summary_table_combined, <span class="st">"summary_table_def.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A partir de los objetos ASEset, que se guardan como archivos .RData, se puede acceder a toda la información que hemos cargado anteriormente (fenotipo, recuentos, identificador de las muestras, genotipo, etc.). Por ejemplo, podemos ver los recuentos iniciales, crudos para una variante concreta, y luego extraer fácilmente los recuentos filtrados donde algunos valores pasan a 0 para descartarse y no utilizarse en el análisis. Además, podríamos extraer la información solo de las personas para las que haya recuentos tras el filtrado. También podemos comprobar en el visualizador de IGV que estos recuentos se han obtenido bien, y los datos que extrae AllelicImbalance coinciden con los almacenados en los .bams de partida. A continuación se incluye un ejemplo de los distintos recuentos de una variante del cromosoma 6:</p>
<ol type="A">
<li><p>Recuentos iniciales (crudos).<br>
<img src="recuentos_raw.png" class="img-fluid" style="width:40.0%"></p></li>
<li><p>Recuentos en el objeto ASEset (después de aplicar los filtrados). <img src="recuentos.png" class="img-fluid" style="width:40.0%"></p></li>
<li><p>Recuento de los individuos a analizar en los siguientes pasos. <img src="recuentos_reducido.png" class="img-fluid" style="width:20.0%"></p></li>
<li><p>Comprobación de los recuentos de 4 individuos en IGV (<em>Integrative genomics viewer</em>). <img src="igv.png" class="img-fluid" style="width:100.0%"></p></li>
</ol>
<p><span style="font-size: 10px;"> <strong>Figura 4.</strong> Recuentos alélicos en los distintos pasos. A. Recuentos crudos generados con la funcion <em>getAlleleCounts</em> de <em>AllelicImbalance</em> en R. B. Recuentos obtenidos tras los pasos de filtrado aplicados. C. Recuentos filtrados, conservando la información únicamente de las personas heterocigotas con recuentos superiores a 10 lecturas por muestra. D. Recuentos alélicos crudos obtenidos en IGV a partir de los archivos .bam procesados de cuatro personas aleatorias, dos sanas (UAMR_0001 y UAMR_0006) y dos enfermas (PNTR_0001 y PNTR_0038)</span></p>
</section>
<section id="análisis-estadísticos" class="level4">
<h4 class="anchored" data-anchor-id="análisis-estadísticos"><strong>2. Análisis estadísticos</strong></h4>
<section id="prueba-wilcoxon-rank-sum-r" class="level5">
<h5 class="anchored" data-anchor-id="prueba-wilcoxon-rank-sum-r"><strong>2.1. Prueba Wilcoxon Rank-Sum (R)</strong></h5>
<p>Una vez generados los recuentos y los objetos ASEset con toda la información necesaria de las variantes heterocigotas de interés y de los individuos de estudio, pasamos a aplicar la prueba de Wilcoxon Rank-Sum o U de Mann Whitney, para comparar la ASE entre individuos afectados y no afectados por TB. En este caso, utilizamos los paquetes <em>AllelicImbalance</em>, <em>VariantAnnotation</em>, <em>biomaRt</em> y <em>SNPlocs.Hsapiens.dbSNP144.GRCh38</em>. Los pasos principales de este código son:</p>
<ul>
<li><p><strong>Conexión con <em>Ensembl</em>:</strong> e establece una conexión con <em>Ensembl</em> mediante la funcion <em>useMart</em> de <em>biomaRt</em> para más adelante en el código obtener información sobre los genes de interés.</p></li>
<li><p><strong>Cálculo de proporciones de alelo de referencia para cada variante:</strong> se verifica que los alelos sean las bases estándar (A, C, G, T), y se calcula la proporción del alelo de referencia como: Nº de lecturas con el alelo de referencia / Nº de lecturas totales, donde Nº de lecturas totales son Nº lecturas contienen el alelo de refernecia + Nº lecturas contienen el alelo alternativo.</p></li>
<li><p><strong>Test de Wilcoxon:</strong> se utiliza la función <em>wilcox.test</em> para comparar la proporción de alelos de referencia entre individuos afectados y no afectados.</p></li>
<li><p><strong>Obtención de información adicional de las variantes:</strong> si la prueba estadística enterior es significativa (p-valor &lt; 0.05), se recupera información adicional de la variante desde <em>Ensembl</em> y <em>SNPlocs.Hsapiens.dbSNP144.GRCh38</em>.</p></li>
<li><p><strong>Almacenamiento de los resultados:</strong> los resultados del test se almacenan en una tabla que se guarda como archivo .txt. Se incluye información como el rsID de la variante, el Gen_Ensembl_ID, y el Gen_External_Name, entre otros.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar AllelicImbalance, VariantAnnotation y otros paquetes necesarios</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AllelicImbalance)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SNPlocs.Hsapiens.dbSNP144.GRCh38)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(biomaRt)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Establecer la ruta donde vamos a guardar los resultados de este paso del TFM</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>result_dir <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="st">"C:/Users/inesu/Desktop/TFM/wilcoxon/data/"</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Conectar con Ensembl para obtener información de genes</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>ensembl_gen <span class="ot">&lt;-</span> <span class="fu">useMart</span>(<span class="st">"ENSEMBL_MART_ENSEMBL"</span>, <span class="at">dataset =</span> <span class="st">"hsapiens_gene_ensembl"</span>, </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">host =</span> <span class="st">"https://www.ensembl.org"</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una tabla de fenotipos a partir de colData</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>fenotipos <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(ase_chr_def))</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una tabla para almacenar el conteo de variantes en cada cromosoma</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>tabla_conteo <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Cromosoma =</span> <span class="fu">character</span>(),</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">N_var_analizadas =</span> <span class="fu">integer</span>(),</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>                           <span class="at">N_var_signif_wilcoxon =</span> <span class="fu">integer</span>(),</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Bucle que recorre cada valor en el vector (son los cromosomas)</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># En el caso del cromosoma 1 y 2, como eran muy grandes se han hecho por mitades</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (valor <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"2_1"</span>, <span class="st">"2_2"</span>, <span class="st">"1_2"</span>, <span class="st">"1_1"</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">22</span>)) {</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Notificación del inicio del proceso para cada cromosoma</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Trabajando con el cromosoma:"</span>, valor, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cargar el archivo .RData correspondiente</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="fu">file.path</span>(data_dir, <span class="fu">paste0</span>(<span class="st">"ase_chr_def_"</span>, valor, <span class="st">".RData"</span>)))</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Archivo ase_chr_def_"</span>, valor, <span class="st">" cargado correctamente.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cargar el archivo .RData correspondiente</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="fu">file.path</span>(data_dir, <span class="fu">paste0</span>(<span class="st">"signif_df_chr"</span>, valor, <span class="st">".RData"</span>)))</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Archivo signif_df_chr"</span>, valor, <span class="st">" cargado correctamente.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>  <span class="do">################################################################################  </span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data frame para almacenar los resultados finales</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>  tabla_resultados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rsID =</span> <span class="fu">character</span>(),</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Cromosoma =</span> <span class="fu">character</span>(),</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Posicion =</span> <span class="fu">integer</span>(),</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">pvalor_wilcox =</span> <span class="fu">numeric</span>(),</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">pvalor_fdr =</span> <span class="fu">numeric</span>(),</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Gen_Ensembl_ID =</span> <span class="fu">character</span>(),</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Gen_External_Name =</span> <span class="fu">character</span>(),</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Num_individuos =</span> <span class="fu">character</span>(),</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reestablecer el contador de variantes analizadas en el test de Wilcoxon</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>  contador_variantes <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>  contador_variantes_signif <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterar sobre las variantes significativas</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (variant <span class="cf">in</span> <span class="fu">unique</span>(signif_df_chr<span class="sc">$</span>Variant)) {</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Analizando variante:"</span>, variant, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener el índice de la variante en ase_chr_def</span></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>    variant_idx <span class="ot">&lt;-</span> <span class="fu">match</span>(variant, <span class="fu">rownames</span>(ase_chr_def))</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(variant_idx)) {</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"La variante"</span>, variant, <span class="st">"no se encontró en ase_chr_def."</span>))</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraer el cromosoma y la posición directamente del nombre de la variante</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>    split_variant <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(variant, <span class="st">"_"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>    cromosoma_var <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"chr"</span>, <span class="st">""</span>, split_variant[<span class="dv">1</span>])  <span class="co"># Parte antes del "_"</span></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>    posicion_var <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(split_variant[<span class="dv">2</span>])  <span class="co"># Parte después del "_"</span></span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear la región cromosómica en el formato correcto para BioMart</span></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>    region <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cromosoma_var, <span class="st">":"</span>, posicion_var, <span class="st">"-"</span>, posicion_var)</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraer los alelos de referencia y alternativos de rowData</span></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>    ref_allele <span class="ot">&lt;-</span> <span class="fu">rowData</span>(ase_chr_def)<span class="sc">$</span>ref[variant_idx]</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>    alt_allele <span class="ot">&lt;-</span> <span class="fu">rowData</span>(ase_chr_def)<span class="sc">$</span>alt[variant_idx]</span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verifica que el alelo de referencia sea A, C, G o T</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>(ref_allele <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>))) {</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Si no es A, C, G o T, pasa a la siguiente iteración o excluye la variante</span></span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span> <span class="co"># usa `next` si estás en un bucle o ajusta según tu código para omitir la variante</span></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verifica que el alelo alternativo sea A, C, G o T</span></span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>(alt_allele <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>))) {</span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Si no es A, C, G o T, pasa a la siguiente iteración o excluye la variante</span></span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span> <span class="co"># usa `next` si estás en un bucle o ajusta según tu código para omitir la variante</span></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener los recuentos alélicos solo para las muestras relevantes</span></span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>    allele_counts <span class="ot">&lt;-</span> <span class="fu">alleleCounts</span>(ase_chr_def)[[variant]]</span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sumar los recuentos por cada persona (fila)</span></span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>    suma_recuentos <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(allele_counts)</span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear un vector con los identificadores de las personas que tienen al menos un recuento distinto de 0</span></span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>    muestras_para_variante <span class="ot">&lt;-</span> <span class="fu">rownames</span>(allele_counts)[suma_recuentos <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>    allele_counts_muestras <span class="ot">&lt;-</span> allele_counts[muestras_para_variante, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcular proporciones de alelo de referencia, manejando errores</span></span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Realizando cálculos de proporciones vara la variante:"</span>, variant, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>    total_counts <span class="ot">&lt;-</span> allele_counts_muestras[, ref_allele] <span class="sc">+</span> allele_counts_muestras[, alt_allele]</span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a>    proporciones_ref <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(total_counts <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, allele_counts_muestras[, ref_allele] <span class="sc">/</span> total_counts)</span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Si el alelo de referencia tiene recuentos 0, asignar proporción 0</span></span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>    proporciones_ref[allele_counts_muestras[, ref_allele] <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraer los fenotipos de las muestras relevantes a partir de la tabla de fenotipos</span></span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a>    fenotipos_muestras <span class="ot">&lt;-</span> fenotipos[muestras_para_variante, <span class="st">"Condition"</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear un dataframe con las proporciones de alelo de referencia y el fenotipo</span></span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a>    datos_variante <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Sample =</span> <span class="fu">rownames</span>(fenotipos_muestras),</span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ProporcionRef =</span> <span class="fu">as.vector</span>(proporciones_ref),</span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Condition =</span> fenotipos_muestras<span class="sc">$</span>Condition)</span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(datos_variante)</span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Contar el número de muestras por condición</span></span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>    num_sanos <span class="ot">&lt;-</span> <span class="fu">sum</span>(datos_variante<span class="sc">$</span>Condition <span class="sc">==</span> <span class="st">"Unaffected"</span>)</span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a>    num_enfermos <span class="ot">&lt;-</span> <span class="fu">sum</span>(datos_variante<span class="sc">$</span>Condition <span class="sc">==</span> <span class="st">"Affected"</span>)</span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Solo realizar el test si hay al menos 2 muestras sanas y 2 enfermas</span></span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (num_sanos <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> num_enfermos <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Realizando test de Wilcoxon para la variante:"</span>, variant, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Incrementar el contador de variantes</span></span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a>      contador_variantes <span class="ot">&lt;-</span> contador_variantes <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Realizar el test de Wilcoxon Rank Sum o U de Mann Whitney</span></span>
<span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a>      wilcox_test <span class="ot">&lt;-</span> <span class="fu">wilcox.test</span>(ProporcionRef <span class="sc">~</span> Condition, <span class="at">data =</span> datos_variante)</span>
<span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Test de wilcoxon realizado con éxito."</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Guardar siempre los resultados del test, no solo los significativos</span></span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a>      tabla_resultados <span class="ot">&lt;-</span> <span class="fu">rbind</span>(tabla_resultados, <span class="fu">data.frame</span>(</span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a>        <span class="at">rsID =</span> <span class="cn">NA</span>, <span class="at">Cromosoma =</span> cromosoma_var, </span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a>        <span class="at">Posicion =</span> posicion_var, </span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a>        <span class="at">pvalor_wilcox =</span> wilcox_test<span class="sc">$</span>p.value,</span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a>        <span class="at">pvalor_fdr =</span> <span class="cn">NA</span>, <span class="at">Gen_Ensembl_ID =</span> <span class="cn">NA</span>, </span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a>        <span class="at">Gen_External_Name =</span> <span class="cn">NA</span>, <span class="at">Num_individuos =</span> <span class="fu">paste</span>(num_sanos, num_enfermos, <span class="at">sep =</span> <span class="st">" + "</span>)</span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Verificar si el test es significativo (p-valor &lt; 0.05)</span></span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(wilcox_test<span class="sc">$</span>p.value) <span class="sc">&amp;&amp;</span> wilcox_test<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"WILCOXON TEST SIGNIFICATIVO para la variante:"</span>, variant, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"Buscando información del SNP y el gen para la variante:"</span>, variant, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a>        contador_variantes_signif <span class="ot">&lt;-</span> contador_variantes_signif <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Obtener información adicional sobre la variante desde Ensembl</span></span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a>        variant_info <span class="ot">&lt;-</span> <span class="fu">getBM</span>(<span class="at">attributes =</span> <span class="fu">c</span>(<span class="st">"chromosome_name"</span>, <span class="st">"start_position"</span>, </span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">"ensembl_gene_id"</span>, <span class="st">"external_gene_name"</span>),</span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a>                              <span class="at">filters =</span> <span class="fu">c</span>(<span class="st">"chromosome_name"</span>, <span class="st">"start"</span>, <span class="st">"end"</span>), </span>
<span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a>                              <span class="at">values =</span> <span class="fu">list</span>(cromosoma_var,posicion_var,posicion_var),</span>
<span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a>                              <span class="at">mart =</span> ensembl_gen)</span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Genero un objeto gr para buscar los rsIDs con SNPlocs.Hsapiens.dbSNP144.GRCh38</span></span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>        gr <span class="ot">&lt;-</span> <span class="fu">GRanges</span>(<span class="at">seqnames =</span> cromosoma_var, <span class="at">ranges =</span> <span class="fu">IRanges</span>(<span class="at">start =</span> posicion_var, <span class="at">end =</span> posicion_var))</span>
<span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Obtener los rsIDs de las variantes usando getSnpIdFromLocation</span></span>
<span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a>        gr_with_rs <span class="ot">&lt;-</span> <span class="fu">getSnpIdFromLocation</span>(gr,SNPlocs.Hsapiens.dbSNP144.GRCh38)</span>
<span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Lo pasamos a un dataframe y el rs quedará como el rowname</span></span>
<span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a>        df_rs <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(gr_with_rs)</span>
<span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Si se encuentra información de la variante, añadir a la tabla de resultados</span></span>
<span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">nrow</span>(variant_info) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb18-168"><a href="#cb18-168" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(<span class="st">"Añadiendo información del SNP y el gen para la variante:"</span>, variant, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-169"><a href="#cb18-169" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Obtener los datos que necesitaremos a continuación</span></span>
<span id="cb18-170"><a href="#cb18-170" aria-hidden="true" tabindex="-1"></a>          rsID <span class="ot">&lt;-</span> <span class="fu">rownames</span>(df_rs)</span>
<span id="cb18-171"><a href="#cb18-171" aria-hidden="true" tabindex="-1"></a>          cromosoma <span class="ot">&lt;-</span> cromosoma_var</span>
<span id="cb18-172"><a href="#cb18-172" aria-hidden="true" tabindex="-1"></a>          posicion <span class="ot">&lt;-</span> posicion_var</span>
<span id="cb18-173"><a href="#cb18-173" aria-hidden="true" tabindex="-1"></a>          gen_ensembl_id <span class="ot">&lt;-</span> variant_info<span class="sc">$</span>ensembl_gene_id[<span class="dv">1</span>]</span>
<span id="cb18-174"><a href="#cb18-174" aria-hidden="true" tabindex="-1"></a>          gen_name <span class="ot">&lt;-</span> variant_info<span class="sc">$</span>external_gene_name[<span class="dv">1</span>]</span>
<span id="cb18-175"><a href="#cb18-175" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb18-176"><a href="#cb18-176" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Formato del número de individuos como "sanos + enfermos"</span></span>
<span id="cb18-177"><a href="#cb18-177" aria-hidden="true" tabindex="-1"></a>          num_individuos <span class="ot">&lt;-</span> <span class="fu">paste</span>(num_sanos, num_enfermos, <span class="at">sep =</span> <span class="st">" + "</span>)</span>
<span id="cb18-178"><a href="#cb18-178" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb18-179"><a href="#cb18-179" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Buscar la fila correspondiente en tabla_resultados usando la columna 'Posicion'</span></span>
<span id="cb18-180"><a href="#cb18-180" aria-hidden="true" tabindex="-1"></a>          fila_index <span class="ot">&lt;-</span> <span class="fu">which</span>(tabla_resultados<span class="sc">$</span>Posicion <span class="sc">==</span> posicion_var <span class="sc">&amp;</span> tabla_resultados<span class="sc">$</span>Cromosoma <span class="sc">==</span> cromosoma_var)</span>
<span id="cb18-181"><a href="#cb18-181" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb18-182"><a href="#cb18-182" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Comprobar si se ha encontrado la fila</span></span>
<span id="cb18-183"><a href="#cb18-183" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">length</span>(fila_index) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb18-184"><a href="#cb18-184" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Actualizar la fila encontrada con la nueva información</span></span>
<span id="cb18-185"><a href="#cb18-185" aria-hidden="true" tabindex="-1"></a>            tabla_resultados[fila_index, <span class="st">"rsID"</span>] <span class="ot">&lt;-</span> rsID</span>
<span id="cb18-186"><a href="#cb18-186" aria-hidden="true" tabindex="-1"></a>            tabla_resultados[fila_index, <span class="st">"Gen_Ensembl_ID"</span>] <span class="ot">&lt;-</span> gen_ensembl_id</span>
<span id="cb18-187"><a href="#cb18-187" aria-hidden="true" tabindex="-1"></a>            tabla_resultados[fila_index, <span class="st">"Gen_External_Name"</span>] <span class="ot">&lt;-</span> gen_name</span>
<span id="cb18-188"><a href="#cb18-188" aria-hidden="true" tabindex="-1"></a>            tabla_resultados[fila_index, <span class="st">"Num_individuos"</span>] <span class="ot">&lt;-</span> num_individuos</span>
<span id="cb18-189"><a href="#cb18-189" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb18-190"><a href="#cb18-190" aria-hidden="true" tabindex="-1"></a>            <span class="fu">warning</span>(<span class="st">"No se ha encontrado la fila correspondiente en la tabla para la posición "</span>, posicion_var)</span>
<span id="cb18-191"><a href="#cb18-191" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb18-192"><a href="#cb18-192" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb18-193"><a href="#cb18-193" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-194"><a href="#cb18-194" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb18-195"><a href="#cb18-195" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Si no hay suficientes muestras, registrar la variante con solo el p-valor</span></span>
<span id="cb18-196"><a href="#cb18-196" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"No hay suficientes muestras para analizar la variante"</span>, variant,<span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-197"><a href="#cb18-197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Número de sanos ="</span>, num_sanos,<span class="st">". Número de enfermos="</span>, num_enfermos,<span class="st">"."</span>)</span>
<span id="cb18-198"><a href="#cb18-198" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-199"><a href="#cb18-199" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb18-200"><a href="#cb18-200" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-201"><a href="#cb18-201" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guardar el número de variantes analizadas para este cromosoma</span></span>
<span id="cb18-202"><a href="#cb18-202" aria-hidden="true" tabindex="-1"></a>  tabla_conteo <span class="ot">&lt;-</span> <span class="fu">rbind</span>(tabla_conteo,</span>
<span id="cb18-203"><a href="#cb18-203" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">data.frame</span>(</span>
<span id="cb18-204"><a href="#cb18-204" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Cromosoma =</span> valor,</span>
<span id="cb18-205"><a href="#cb18-205" aria-hidden="true" tabindex="-1"></a>                          <span class="at">N_var_analizadas =</span> contador_variantes,</span>
<span id="cb18-206"><a href="#cb18-206" aria-hidden="true" tabindex="-1"></a>                          <span class="at">N_var_signif_wilcoxon =</span> contador_variantes_signif))</span>
<span id="cb18-207"><a href="#cb18-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Tabla de conteos actualizada con:"</span>, contador_variantes,<span class="st">"y"</span>,contador_variantes_signif, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-208"><a href="#cb18-208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-209"><a href="#cb18-209" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajustar los p-valores mediante FDR </span></span>
<span id="cb18-210"><a href="#cb18-210" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (por el peq. tamaño muestral no se esperan resultados significativos)</span></span>
<span id="cb18-211"><a href="#cb18-211" aria-hidden="true" tabindex="-1"></a>  tabla_resultados<span class="sc">$</span>pvalor_fdr <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(tabla_resultados<span class="sc">$</span>pvalor_wilcox, <span class="at">method =</span> <span class="st">"fdr"</span>)</span>
<span id="cb18-212"><a href="#cb18-212" aria-hidden="true" tabindex="-1"></a>  archivo_restultados <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"resultados_wilcox_chr"</span>, valor, <span class="st">".txt"</span>)</span>
<span id="cb18-213"><a href="#cb18-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(tabla_resultados, <span class="at">file =</span> archivo_restultados, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-214"><a href="#cb18-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Se han guardado los resultados obtenidos del cromosoma:"</span>, valor, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-215"><a href="#cb18-215" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-216"><a href="#cb18-216" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtrar las variantes significativas</span></span>
<span id="cb18-217"><a href="#cb18-217" aria-hidden="true" tabindex="-1"></a>  tabla_significativa <span class="ot">&lt;-</span> tabla_resultados[<span class="sc">!</span><span class="fu">is.na</span>(tabla_resultados<span class="sc">$</span>pvalor_wilcox) <span class="sc">&amp;</span> tabla_resultados<span class="sc">$</span>pvalor_wilcox <span class="sc">&lt;</span> <span class="fl">0.05</span>, ]</span>
<span id="cb18-218"><a href="#cb18-218" aria-hidden="true" tabindex="-1"></a>  tabla_significativa_fdr <span class="ot">&lt;-</span> tabla_resultados[<span class="sc">!</span><span class="fu">is.na</span>(tabla_resultados<span class="sc">$</span>pvalor_fdr) <span class="sc">&amp;</span> tabla_resultados<span class="sc">$</span>pvalor_fdr <span class="sc">&lt;</span> <span class="fl">0.05</span>, ]</span>
<span id="cb18-219"><a href="#cb18-219" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-220"><a href="#cb18-220" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guardar las tablas solo si contienen datos</span></span>
<span id="cb18-221"><a href="#cb18-221" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(tabla_significativa) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb18-222"><a href="#cb18-222" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear el nombre del archivo con la iteración actual (valor)</span></span>
<span id="cb18-223"><a href="#cb18-223" aria-hidden="true" tabindex="-1"></a>    archivo_significativa <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"signif_var_wilcox_chr"</span>, valor, <span class="st">".txt"</span>)</span>
<span id="cb18-224"><a href="#cb18-224" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(tabla_significativa, <span class="at">file =</span> archivo_significativa, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-225"><a href="#cb18-225" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Se ha generado la tabla de variantes significativas para el cromosoma:"</span>, valor, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-226"><a href="#cb18-226" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-227"><a href="#cb18-227" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-228"><a href="#cb18-228" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(tabla_significativa_fdr) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb18-229"><a href="#cb18-229" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear el nombre del archivo con la iteración actual (valor)</span></span>
<span id="cb18-230"><a href="#cb18-230" aria-hidden="true" tabindex="-1"></a>    archivo_significativa_fdr <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"signif_var_fdr_chr"</span>, valor, <span class="st">".txt"</span>)</span>
<span id="cb18-231"><a href="#cb18-231" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(tabla_significativa_fdr, <span class="at">file =</span> archivo_significativa_fdr, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-232"><a href="#cb18-232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Se ha generado la tabla de variantes SIGNIF-FDR para el cromosoma:"</span>, valor, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-233"><a href="#cb18-233" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-234"><a href="#cb18-234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-235"><a href="#cb18-235" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mostrar las tablas de resultados significativos</span></span>
<span id="cb18-236"><a href="#cb18-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(tabla_resultados)</span>
<span id="cb18-237"><a href="#cb18-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Tabla resultados con"</span>, <span class="fu">dim</span>(tabla_resultados)[<span class="dv">1</span>],<span class="st">"variantes analizadas y"</span>,</span>
<span id="cb18-238"><a href="#cb18-238" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dim</span>(tabla_resultados)[<span class="dv">2</span>], <span class="st">"personas incluidas."</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-239"><a href="#cb18-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tabla_significativa)</span>
<span id="cb18-240"><a href="#cb18-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tabla_significativa_fdr)</span>
<span id="cb18-241"><a href="#cb18-241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-242"><a href="#cb18-242" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Eliminamos todos los objetos que no sean necesarios</span></span>
<span id="cb18-243"><a href="#cb18-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">"fenotipos"</span>, <span class="st">"result_dir"</span>, <span class="st">"ensembl_gen"</span>, <span class="st">"valor"</span>, <span class="st">"data_dir"</span>, <span class="st">"tabla_conteo"</span>)))</span>
<span id="cb18-244"><a href="#cb18-244" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-245"><a href="#cb18-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-246"><a href="#cb18-246" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardar la tabla de conteo en un archivo</span></span>
<span id="cb18-247"><a href="#cb18-247" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(tabla_conteo, <span class="at">file =</span> <span class="st">"tabla_conteo_variantes.txt"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-248"><a href="#cb18-248" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Se ha generado la tabla de conteo de variantes analizadas.</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una vez obtenidos todos los resultados del test de Wilcoxon Rank-Sum, podemos representar todas las variantes analizadas y su respectivo p-valor en un gráfico de tipo Manhattan Plot, generado con el paquete <em>ggplot2</em> en R. Este gráfico permite visualizar la distribución de estas variantes a lo largo de todo el genoma, así como su significación estadística (cuánto más arriba en el eje Y, más significativo). El código necesario para hacer este gráfico se incluye a continuación:</p>
<p><img src="manhattan_plot.png" class="img-fluid" style="width:110.0%"> <span style="font-size: 10px;"> <strong>Figura 5.</strong> Distribución genómica de las variantes analizadas en el test de Wilcoxon Rank Sum. Se muestran los cromosomas en el eje X y los p-valores transformados en el eje Y. La línea de color rojo indica el umbral de significación estadística empleado (p-valor &lt; 0.05).</span></p>
<p>El código necesario para generar el gráfico de tipo Manhattan anterior es:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar las librerías necesarias</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">=</span> <span class="st">"C:/irs_tfm/wilcoxon/Resultados_2_sanos_vs_enf/"</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una lista de archivos a cargar</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>archivos <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> data_dir, <span class="at">pattern =</span> <span class="st">"resultados_wilcox_chr.*</span><span class="sc">\\</span><span class="st">.txt"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer y combinar todos los archivos</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> archivos <span class="sc">%&gt;%</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(read_delim, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>) <span class="sc">%&gt;%</span>  <span class="co"># Leer cada archivo</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"Archivo"</span>) <span class="sc">%&gt;%</span>  <span class="co"># Combinar en un solo dataframe</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cromosoma =</span> <span class="fu">factor</span>(Cromosoma, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="st">"1_1"</span>, <span class="st">"1_2"</span>, <span class="dv">2</span>, <span class="st">"2_1"</span>, <span class="st">"2_2"</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">22</span>))) <span class="co"># Orden correcto</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar los cromosomas 1_1 y 1_2, así como 2_1 y 2_2, en un solo cromosoma</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cromosoma =</span> <span class="fu">case_when</span>(</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    Cromosoma <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1_1"</span>, <span class="st">"1_2"</span>) <span class="sc">~</span> <span class="st">"1"</span>,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    Cromosoma <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2_1"</span>, <span class="st">"2_2"</span>) <span class="sc">~</span> <span class="st">"2"</span>,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(Cromosoma)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Suponiendo que tus datos están almacenados en un objeto llamado 'datos'</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>datos_seleccionados <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rsID, Cromosoma, Posicion, pvalor_wilcox)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir las columnas a tipo numérico</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>datos_seleccionados_numeric <span class="ot">&lt;-</span> datos_seleccionados <span class="sc">%&gt;%</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cromosoma =</span> <span class="fu">as.numeric</span>(Cromosoma),</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">Posicion =</span> <span class="fu">as.numeric</span>(Posicion),</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">pvalor_wilcox =</span> <span class="fu">as.numeric</span>(pvalor_wilcox)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos de tamaño de los cromosomas</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>chr_sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">248956422</span>, <span class="dv">242193529</span>, <span class="dv">198295559</span>, <span class="dv">190214555</span>, <span class="dv">181538259</span>, </span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>               <span class="dv">170805979</span>, <span class="dv">159345973</span>, <span class="dv">145138636</span>, <span class="dv">138394717</span>, <span class="dv">133797422</span>, </span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>               <span class="dv">135086622</span>, <span class="dv">133275309</span>, <span class="dv">114364328</span>, <span class="dv">107043718</span>, <span class="dv">101991189</span>, </span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>               <span class="dv">90338345</span>, <span class="dv">83257441</span>, <span class="dv">80373285</span>, <span class="dv">58617616</span>, <span class="dv">64444167</span>, </span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>               <span class="dv">46709983</span>, <span class="dv">50818468</span>)</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar datos eliminando filas con NA y valores de pvalor_wilcox fuera del rango [0,1]</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>datos_seleccionados_numeric <span class="ot">&lt;-</span> datos_seleccionados_numeric <span class="sc">%&gt;%</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(pvalor_wilcox) <span class="sc">&amp;</span> pvalor_wilcox <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> pvalor_wilcox <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="co"># Filtrar NA y p-valor fuera de rango</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cromosoma =</span> <span class="fu">as.factor</span>(Cromosoma),  <span class="co"># Asegurarse de que Cromosoma sea un factor</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">color_cromosoma =</span> <span class="fu">ifelse</span>(<span class="fu">as.numeric</span>(Cromosoma) <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"skyblue"</span>, <span class="st">"dodgerblue"</span>),</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cromosoma_numerico =</span> <span class="fu">as.numeric</span>(Cromosoma)  <span class="co"># Crear columna numérica para ordenar cromosomas</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajustar las posiciones según el tamaño de los cromosomas</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos_cromosoma =</span> Posicion <span class="sc">+</span> <span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">0</span>, chr_sizes[<span class="sc">-</span><span class="fu">length</span>(chr_sizes)]))[Cromosoma_numerico]</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos_seleccionados_numeric, <span class="fu">aes</span>(<span class="at">x =</span> pos_cromosoma, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(pvalor_wilcox), <span class="at">color =</span> color_cromosoma)) <span class="sc">+</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Usar puntos con transparencia</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_identity</span>() <span class="sc">+</span>  <span class="co"># Usar colores definidos por el usuario</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">cumsum</span>(chr_sizes) <span class="sc">-</span> chr_sizes <span class="sc">/</span> <span class="dv">2</span>,  <span class="co"># Poner un corte en el centro de cada cromosoma</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>),  <span class="co"># Etiquetas para los cromosomas, solo el número</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)  <span class="co"># Eliminar espacio extra antes del primer cromosoma</span></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">1.3</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">1.0</span>) <span class="sc">+</span>  <span class="co"># Línea de significación más gruesa</span></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="dv">2</span>),  <span class="co"># Reducir tamaño y ajustar la posición de las etiquetas</span></span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,  <span class="co"># Eliminar leyenda</span></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>)  <span class="co"># Añadir algo de grosor a las marcas del eje</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"-log10(p-valor)"</span>,</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Cromosoma"</span>,  <span class="co"># Título del eje X</span></span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Manhattan Plot - Diferencias en Expresión Alelica"</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)  <span class="co"># Centrar título</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardar el gráfico en un archivo PNG de alta calidad</span></span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"manhattan_plot2.png"</span>, </span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> <span class="fu">last_plot</span>(), </span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>, </span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, </span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)  <span class="co"># Alta resolución (300 dpi)</span></span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"manhattan_plot.pdf"</span>, <span class="at">plot =</span> <span class="fu">last_plot</span>(), <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">4</span>)<span class="sc">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prueba-exacta-de-fisher-r" class="level5">
<h5 class="anchored" data-anchor-id="prueba-exacta-de-fisher-r"><strong>2.2 Prueba Exacta de Fisher (R)</strong></h5>
<p>Una vez realizado el test de Wilcoxon Rank-Sum, las variantes candidatas (con p-valor &lt; 0.05 en el test de Wilcoxon Rank-Sum), se clasifican cualitativamente según el alelo que se expresa de forma mayoritaria en cada individuo (referencia o alternativo).</p>
<p>Para ello, se trabaja con cada cromosoma de interés (del 1 al 22), y el código siguiente permite cargar los datos y calcular las proporciones de alelo de referencia. Además, aplica el test exacto de Fisher para evaluar si la distribución de los alelos que se expresan de forma mayoritaria varía significativamente entre las dos condiciones de estudio (sanos <em>vs</em> enfermos). Si se detecta un cambio significativo (p-valor ≤ 0.05), se guarda una tabla con los recuentos de alelos y las estadísticas correspondientes (odds ratio, p-valor de Fisher). Los resultados se generan por cromosoma y se exportan a archivos de texto. Las funciones principales que se utilizan en este fragmento de código son:</p>
<ul>
<li><p><strong><em>alleleCounts()</em>:</strong> Extrae los recuentos de alelos para cada variante.</p></li>
<li><p><strong><em>fisher.test()</em>:</strong> Realiza el test exacto de Fisher para comparar la distribución de alelos en las condiciones afectadas y no afectadas.</p></li>
<li><p><strong><em>left_join()</em>:</strong> Fusiona los resultados de los recuentos de alelos con las tablas de variantes significativas.</p></li>
<li><p><strong><em>write.table()</em>:</strong> Guarda los resultados en archivos de texto.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar AllelicImbalance, VariantAnnotation y otros paquetes necesarios</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AllelicImbalance)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SNPlocs.Hsapiens.dbSNP144.GRCh38)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(biomaRt)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Establecer la ruta donde queremos guardar los resultados</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>result_dir <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="st">"C:/Users/inesu/Desktop/TFM/wilcoxon/data/"</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>subcarpeta <span class="ot">&lt;-</span> <span class="st">"C:/Users/inesu/Desktop/TFM/wilcoxon/recuentos_concretos/"</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una tabla de fenotipos a partir de colData</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>fenotipos <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(ase_chr_def))</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Bucle que recorre cada valor en el vector (los cromosomas estudiados)</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (valor <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">21</span>, <span class="dv">19</span><span class="sc">:</span><span class="dv">3</span>, <span class="st">"2_1"</span>, <span class="st">"2_2"</span>, <span class="st">"1_2"</span>, <span class="st">"1_1"</span>)) {</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Notificación del inicio del proceso para cada cromosoma</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Trabajando con el cromosoma:"</span>, valor, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cargar el archivo .RData correspondiente</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="fu">file.path</span>(data_dir, <span class="fu">paste0</span>(<span class="st">"ase_chr_def_"</span>, valor, <span class="st">".RData"</span>)))</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Archivo ase_chr_def_"</span>,valor, <span class="st">"cargado correctamente.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setwd</span>(data_dir)</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cargar el archivo .txt correspondiente con las variantes de interés</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generar el nombre del archivo dinámicamente</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  file_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"signif_var_wilcox_chr"</span>, valor, <span class="st">".txt"</span>)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  signif_data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(file_name, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  var_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  var_153 <span class="ot">&lt;-</span> var_list[[<span class="fu">paste0</span>(<span class="st">"chr"</span>, valor)]] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"chr"</span>, signif_data<span class="sc">$</span>Cromosoma, <span class="st">"_"</span>, signif_data<span class="sc">$</span>Posicion)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Archivo .txt del cromosoma"</span>, valor, <span class="st">" cargado correctamente.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setwd</span>(result_dir)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="do">################################################################################  </span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear un data frame vacío donde se guardarán los resultados</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  proporciones_medias <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Cromosoma =</span> <span class="fu">character</span>(),</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Posicion =</span> <span class="fu">integer</span>(),</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Affected =</span> <span class="fu">numeric</span>(),</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Unaffected =</span> <span class="fu">numeric</span>(),</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">cambio_de_alelo =</span> <span class="fu">character</span>(),</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>  <span class="do">################################################################################  </span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterar sobre las variantes significativas</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (variant <span class="cf">in</span> var_153) {</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Analizando variante:"</span>, variant, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener el índice de la variante en ase_chr_def</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>    variant_idx <span class="ot">&lt;-</span> <span class="fu">match</span>(variant, <span class="fu">rownames</span>(ase_chr_def))</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(variant_idx)) {</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"La variante"</span>, variant, <span class="st">"no se encontró en ase_chr_def."</span>))</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraer el cromosoma y la posición directamente del nombre de la variante</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>    split_variant <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(variant, <span class="st">"_"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>    cromosoma_var <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"chr"</span>, <span class="st">""</span>, split_variant[<span class="dv">1</span>])  <span class="co"># Parte antes del "_"</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>    posicion_var <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(split_variant[<span class="dv">2</span>])  <span class="co"># Parte después del "_"</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraer los alelos de referencia y alternativos de rowData</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>    ref_allele <span class="ot">&lt;-</span> <span class="fu">rowData</span>(ase_chr_def)<span class="sc">$</span>ref[variant_idx]</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>    alt_allele <span class="ot">&lt;-</span> <span class="fu">rowData</span>(ase_chr_def)<span class="sc">$</span>alt[variant_idx]</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verifica que el alelo de referencia sea A, C, G o T</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>(ref_allele <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>))) {</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Si no es A, C, G o T, pasa a la siguiente iteración o excluye la variante</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span> <span class="co"># usa `next` si estás en un bucle o ajusta según tu código para omitir la variante</span></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verifica que el alelo alternativo sea A, C, G o T</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>(alt_allele <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>))) {</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Si no es A, C, G o T, pasa a la siguiente iteración o excluye la variante</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span> <span class="co"># usa `next` si estás en un bucle o ajusta según tu código para omitir la variante</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener los recuentos alélicos</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>    allele_counts <span class="ot">&lt;-</span> <span class="fu">alleleCounts</span>(ase_chr_def)[[variant]]</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sumar los recuentos por cada persona (fila)</span></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>    suma_recuentos <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(allele_counts)</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear un vector con los identificadores de las personas que tienen al menos un recuento distinto de 0</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>    muestras_para_variante <span class="ot">&lt;-</span> <span class="fu">rownames</span>(allele_counts)[suma_recuentos <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>    allele_counts_muestras <span class="ot">&lt;-</span> allele_counts[muestras_para_variante, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcular proporciones de alelo de referencia, manejando errores</span></span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Realizando cálculos de proporciones vara la variante:"</span>, variant, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>    total_counts <span class="ot">&lt;-</span> allele_counts_muestras[, ref_allele] <span class="sc">+</span> allele_counts_muestras[, alt_allele]</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>    proporciones_ref <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(total_counts <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, allele_counts_muestras[, ref_allele] <span class="sc">/</span> total_counts)</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Si el alelo de referencia tiene recuentos 0, asignar proporción 0</span></span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>    proporciones_ref[allele_counts_muestras[, ref_allele] <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraer los fenotipos de las muestras relevantes a partir de la tabla de fenotipos</span></span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>    fenotipos_muestras <span class="ot">&lt;-</span> fenotipos[muestras_para_variante, <span class="st">"Condition"</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear un dataframe con las proporciones de alelo de referencia y el fenotipo</span></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>    datos_variante <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Sample =</span> <span class="fu">rownames</span>(fenotipos_muestras),</span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ProporcionRef =</span> <span class="fu">as.vector</span>(proporciones_ref),</span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Condition =</span> fenotipos_muestras<span class="sc">$</span>Condition)</span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(datos_variante)</span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>    <span class="do">############################################################################</span></span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear una nueva columna para clasificar el alelo mayoritario</span></span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a>    datos_variante<span class="sc">$</span>AleloMayoritario <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(datos_variante<span class="sc">$</span>ProporcionRef <span class="sc">&gt;</span> <span class="fl">0.5</span>, </span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Referencia"</span>, <span class="st">"Alternativo"</span>)</span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(datos_variante)</span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear la tabla de contingencia</span></span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a>    tabla_contingencia <span class="ot">&lt;-</span> <span class="fu">table</span>(datos_variante<span class="sc">$</span>Condition, datos_variante<span class="sc">$</span>AleloMayoritario)</span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(tabla_contingencia)</span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verificar las dimensiones de la tabla</span></span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a>    dim_tabla <span class="ot">&lt;-</span> <span class="fu">dim</span>(tabla_contingencia)</span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Si la tabla no tiene 2 filas, añadir una fila de ceros</span></span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (dim_tabla[<span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a>      tabla_contingencia <span class="ot">&lt;-</span> <span class="fu">rbind</span>(tabla_contingencia, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))  <span class="co"># Añadir una fila de ceros</span></span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Si la tabla no tiene 2 columnas, añadir una columna de ceros</span></span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (dim_tabla[<span class="dv">2</span>] <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a>      tabla_contingencia <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tabla_contingencia, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))  <span class="co"># Añadir una columna de ceros</span></span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(</span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a>      tabla_contingencia,</span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"tabla_conting_"</span>, variant, <span class="st">".txt"</span>),</span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="cn">NA</span>,</span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a>      <span class="at">quote =</span> <span class="cn">FALSE</span></span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Realizar el test exacto de fisher (es un tipo de test de asociación)</span></span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Utilizamos Fisher porque es como Chi cuadrado, pero para nº datos reducido</span></span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a>    fisher_result <span class="ot">&lt;-</span> <span class="fu">fisher.test</span>(tabla_contingencia)</span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(fisher_result)</span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraer p-valor y odds ratio del test de Fisher</span></span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a>    p_valor_fisher <span class="ot">&lt;-</span> fisher_result<span class="sc">$</span>p.value</span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a>    odds_ratio <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(fisher_result<span class="sc">$</span>estimate), <span class="cn">NA</span>, fisher_result<span class="sc">$</span>estimate)</span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a>    <span class="do">############################################################################</span></span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a>    medias_por_grupo <span class="ot">&lt;-</span> datos_variante <span class="sc">%&gt;%</span></span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(Condition) <span class="sc">%&gt;%</span></span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">media =</span> <span class="fu">mean</span>(ProporcionRef, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a>    media_df <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(medias_por_grupo<span class="sc">$</span>media))</span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Asignar nombres a las columnas para facilitar su comprensión</span></span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(media_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Affected"</span>, <span class="st">"Unaffected"</span>)</span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Añadir la columna cromosoma, posición, p-val y odd ratio de la variante al resultado</span></span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a>    media_df<span class="sc">$</span>Cromosoma <span class="ot">&lt;-</span> cromosoma_var</span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a>    media_df<span class="sc">$</span>Posicion <span class="ot">&lt;-</span> posicion_var</span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a>    media_df<span class="sc">$</span>Pvalor_Fisher <span class="ot">&lt;-</span> p_valor_fisher</span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a>    media_df<span class="sc">$</span>Odds_Ratio <span class="ot">&lt;-</span> odds_ratio</span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verificar el cambio de la expresión predominante del alelo (SI O NO)</span></span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a>    media_df<span class="sc">$</span>cambio_de_alelo <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(media_df<span class="sc">$</span>Pvalor_Fisher <span class="sc">&lt;=</span> <span class="fl">0.05</span>, <span class="st">"SI"</span>, <span class="st">"NO"</span>)</span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Guardar allele_counts_muestras en un archivo .txt solo si cambio_de_alelo es "SI"</span></span>
<span id="cb20-171"><a href="#cb20-171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (media_df<span class="sc">$</span>cambio_de_alelo <span class="sc">==</span> <span class="st">"SI"</span>) {</span>
<span id="cb20-172"><a href="#cb20-172" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb20-173"><a href="#cb20-173" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setwd</span>(subcarpeta)</span>
<span id="cb20-174"><a href="#cb20-174" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Guardar el objeto allele_counts_muestras en un archivo .txt</span></span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write.table</span>(</span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a>        allele_counts_muestras,</span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a>        <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"subset_counts_"</span>, variant, <span class="st">".txt"</span>),</span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a>        <span class="at">row.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="cn">NA</span>,</span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a>        <span class="at">quote =</span> <span class="cn">FALSE</span></span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setwd</span>(result_dir)</span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-187"><a href="#cb20-187" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorganizar las columnas para que la tabla tenga la estructura correcta</span></span>
<span id="cb20-188"><a href="#cb20-188" aria-hidden="true" tabindex="-1"></a>    media_df <span class="ot">&lt;-</span> media_df[, <span class="fu">c</span>(<span class="st">"Cromosoma"</span>, <span class="st">"Posicion"</span>, <span class="st">"Affected"</span>, <span class="st">"Unaffected"</span>,</span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Pvalor_Fisher"</span>, <span class="st">"cambio_de_alelo"</span>, <span class="st">"Odds_Ratio"</span>)]</span>
<span id="cb20-190"><a href="#cb20-190" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-191"><a href="#cb20-191" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Añadir el resultado de la variante a la tabla final</span></span>
<span id="cb20-192"><a href="#cb20-192" aria-hidden="true" tabindex="-1"></a>    proporciones_medias <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(proporciones_medias, media_df)</span>
<span id="cb20-193"><a href="#cb20-193" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-194"><a href="#cb20-194" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb20-195"><a href="#cb20-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-196"><a href="#cb20-196" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Guardar las tablas solo si contienen datos</span></span>
<span id="cb20-197"><a href="#cb20-197" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(proporciones_medias) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb20-198"><a href="#cb20-198" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear el nombre del archivo con la iteración actual (valor)</span></span>
<span id="cb20-199"><a href="#cb20-199" aria-hidden="true" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"data_solo_fisher_"</span>, valor, <span class="st">".txt"</span>)</span>
<span id="cb20-200"><a href="#cb20-200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(proporciones_medias, <span class="at">file =</span> file_name, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-201"><a href="#cb20-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Se ha generado la tabla de medias para el cromosoma:"</span>, valor, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-202"><a href="#cb20-202" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-203"><a href="#cb20-203" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-204"><a href="#cb20-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(proporciones_medias)</span>
<span id="cb20-205"><a href="#cb20-205" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-206"><a href="#cb20-206" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Realizar la unión de signif_data con proporciones_medias</span></span>
<span id="cb20-207"><a href="#cb20-207" aria-hidden="true" tabindex="-1"></a>  signif_data<span class="sc">$</span>Cromosoma <span class="ot">&lt;-</span> <span class="fu">as.character</span>(signif_data<span class="sc">$</span>Cromosoma)</span>
<span id="cb20-208"><a href="#cb20-208" aria-hidden="true" tabindex="-1"></a>  proporciones_medias<span class="sc">$</span>Cromosoma <span class="ot">&lt;-</span> <span class="fu">as.character</span>(proporciones_medias<span class="sc">$</span>Cromosoma)</span>
<span id="cb20-209"><a href="#cb20-209" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadir columnas solo cuando las columnas "Cromosoma" y "Posicion" coinciden</span></span>
<span id="cb20-210"><a href="#cb20-210" aria-hidden="true" tabindex="-1"></a>  signif_data <span class="ot">&lt;-</span> signif_data <span class="sc">%&gt;%</span></span>
<span id="cb20-211"><a href="#cb20-211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(proporciones_medias <span class="sc">%&gt;%</span> <span class="fu">select</span>(Cromosoma, Posicion, Affected,</span>
<span id="cb20-212"><a href="#cb20-212" aria-hidden="true" tabindex="-1"></a>                                             Unaffected, Pvalor_Fisher,</span>
<span id="cb20-213"><a href="#cb20-213" aria-hidden="true" tabindex="-1"></a>                                             cambio_de_alelo, Odds_Ratio),</span>
<span id="cb20-214"><a href="#cb20-214" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Cromosoma"</span>, <span class="st">"Posicion"</span>))</span>
<span id="cb20-215"><a href="#cb20-215" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-216"><a href="#cb20-216" aria-hidden="true" tabindex="-1"></a>  tabla_final <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"fisher_full_"</span>, valor, <span class="st">".txt"</span>)</span>
<span id="cb20-217"><a href="#cb20-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(signif_data, <span class="at">file =</span> tabla_final, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-218"><a href="#cb20-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Se ha generado la tabla de final para el cromosoma:"</span>, valor, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-219"><a href="#cb20-219" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-220"><a href="#cb20-220" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Eliminamos todos los objetos que no sean necesarios</span></span>
<span id="cb20-221"><a href="#cb20-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">"fenotipos"</span>, <span class="st">"result_dir"</span>, <span class="st">"data_dir"</span>,</span>
<span id="cb20-222"><a href="#cb20-222" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"subcarpeta"</span>, <span class="st">"ase_chr_def"</span>, <span class="st">"valor"</span>, <span class="st">"proporciones_medias"</span>)))</span>
<span id="cb20-223"><a href="#cb20-223" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-224"><a href="#cb20-224" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Después, se pueden combinar los archivos resultantes para guardarlos en formatos específicos como .xlxs o .txt, que permitan reunir todos los datos en un <em>data frame</em> para inspeccionar los resultados o para realizar los pasos posteriores del TFM.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(writexl)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir el directorio donde están los archivos .txt de partida</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>dir_path <span class="ot">&lt;-</span> <span class="st">"C:/Users/inesu/Desktop/TFM/wilcoxon/Resultados/full_data"</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener una lista de todos los archivos que coinciden con el patrón</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> dir_path, <span class="at">pattern =</span> <span class="st">"^medias_wilcox_.*</span><span class="sc">\\</span><span class="st">.txt$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer el primer archivo con encabezado</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>first_data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(files[<span class="dv">1</span>], <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer los archivos restantes sin encabezado, asignando los nombres de columna del primer archivo</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>other_data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(files[<span class="sc">-</span><span class="dv">1</span>], <span class="cf">function</span>(file) {</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(file, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(first_data)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinar el primer archivo con los demás archivos en un solo data frame</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>will_wilcoxon <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">c</span>(<span class="fu">list</span>(first_data), other_data))</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminar las filas adicionales del encabezado, si existen</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>will_wilcoxon <span class="ot">&lt;-</span> will_wilcoxon[will_wilcoxon<span class="sc">$</span>rsID <span class="sc">!=</span> <span class="st">"rsID"</span>, ]</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardar el resultado en un archivo Excel y en otro RData</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(will_wilcoxon, <span class="st">"will_wilcoxon.xlsx"</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(will_wilcoxon, <span class="at">file =</span> <span class="st">"will_wilcoxon.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="anotación-y-enriquecimiento-funcional" class="level4">
<h4 class="anchored" data-anchor-id="anotación-y-enriquecimiento-funcional"><strong>3. Anotación y enriquecimiento funcional</strong></h4>
<section id="anotación-funcional-vep" class="level5">
<h5 class="anchored" data-anchor-id="anotación-funcional-vep"><strong>3.1. Anotación funcional (VEP)</strong></h5>
<p>Una vez realizado el análisis de ASE, se puede pasar a interpretar los resultados. En este caso se ha utilizado la herramienta web de <em>VEP</em> (<em>Variant Effect Predictor</em>) de <em>Ensembl</em> para extraer información sobre la anotación de las variantes canididatas, en concreto, se ha obtenido información de los valores CADD (<em>Combined Annotation Dependent Depletion</em>) y de las frecuencias alélicas de la base de datos <em>genomÁD genomes</em> correspondientes a la población europea no finlandesa. El enlace para aceder a esta herramienta es el siguiente: <a href="https://www.ensembl.org/info/docs/tools/vep/index.html">VEP-Ensembl</a>.</p>
</section>
<section id="enriquecimiento-funcional-enrichr" class="level5">
<h5 class="anchored" data-anchor-id="enriquecimiento-funcional-enrichr"><strong>3.2. Enriquecimiento funcional (Enrichr)</strong></h5>
<p>También se ha realizado un análisis de enriquecimiento funcional de las variantes candidatas obtenidas, mediante la herramienta Enrichr, que está disponible en el siguiente enlace: <a href="https://maayanlab.cloud/Enrichr/">Enrichr</a>.</p>
<p>Esta herramienta nos permite obtener información de múltiples bases de datos. En nuestro caso, nos hemos centrado en los resultados de tres bases de datos complementarias: <em>WikiPathways</em>, <em>Gene Ontology (GO) Biological Process</em> y <em>Reactome</em>. Como <em>output</em>, esta herramienta nos puede dar las tablas incluidas en el <strong>Anexo 4</strong> del TFM, y también algunos gráficos como los que se incluyen a continuación, donde se indican los procesos con mayor enriquecimiento:</p>
<ol type="A">
<li><em>WikiPathways</em></li>
</ol>
<p><img src="WikiPathway_2021_Human_bar_graph.png" class="img-fluid" style="width:50.0%"></p>
<ol start="2" type="A">
<li><em>GO Biological Process</em></li>
</ol>
<p><img src="GO_Biological_Process_2023_bar_graph.png" class="img-fluid" style="width:50.0%"></p>
<ol start="3" type="A">
<li><em>Reactome</em></li>
</ol>
<p><img src="Reactome_2022_bar_graph.png" class="img-fluid" style="width:50.0%"></p>
<p><span style="font-size: 10px;"> <strong>Figura 6.</strong> Gráficos de barras obtenidos en el análisis de enriquecimiento funcional realizado con Enrichr. Se incluye información de tres bases de datos: A) <em>WikiPathways</em>, B) <em>GO Biological Process</em>; y C) <em>Reactome</em>.</span></p>
</section>
<section id="validación-con-resultados-de-un-análisis-gene-based-previo" class="level5">
<h5 class="anchored" data-anchor-id="validación-con-resultados-de-un-análisis-gene-based-previo"><strong>3.3. Validación con resultados de un análisis <em>gene-based</em> previo </strong></h5>
<p>Finalmente, los resultados obtenidos se pueden comparar con los resultados de otros estudios, como es el caso de un análisis de tipo <em>gene-based</em> realizado previamente por el grupo de invesitigación a partir de los datos de la mayor cohorte de trastorno bipolar que hay hasta la fecha, generada por el consorcio PGC (<em>Psychiatric Genomics Consortium</em>).</p>
<p>Una vez comparados estos resultados, podemos representar las variantes de los genes que hayan obtenido p-valores significativos en ambos análisis, para así, visualizar la distribución de estas variantes y su significación estadística. Los p-valores significativos del análisis <em>gene-based</em> indican que dichos genes están fuertemente asociación con la enfermedad, lo que sugiere que las variantes dentro de esos genes podrían tener un papel relevante en la patogénesis del trastorno bipolar. Este tipo de gráficos se puede conseguir con la herramienta LocusZoom, disponible en: <a href="http://locuszoom.org/genform.php?type=yourdata">LocusZoom</a>.</p>
<p>A continuación se incluye un ejemplo de un gráfico generado con la herramienta LocusZoom, manteniendo los parámetros por defecto salvo el <em>Flankg Size</em> que se ha establecido en 5 Kb. <img src="trank1.png" class="img-fluid" style="width:80.0%"> <span style="font-size: 10px;"> <strong>Figura 7.</strong> Gráfico generado con la herramienta <em>LocusZoom</em> donde se representan las variantes localizadas en el gen <em>TRANK1</em>. Se trata del gen con mayor significación estadística en el análisis <em>gene-based</em>, que ha obtenido también un p-valor significativo en el análisis de ASE realizado en este TFM.</span></p>
</section>
</section>
</section>
<section id="referencias" class="level3">
<h3 class="anchored" data-anchor-id="referencias"><strong>Referencias</strong></h3>
<div style="margin-left: 1.5em; text-indent: -1.5em;">
<p>
Chen, E. Y., Tan, C. M., Kou, Y., Duan, Q., Wang, Z., Meirelles, G. V., Clark, N. R., &amp; Ma’ayan, A. (2013). Enrichr: interactive and collaborative HTML5 gene list enrichment analysis tool. BMC bioinformatics, 14, 128. <a href="https://doi.org/10.1186/1471-2105-14-128">https://doi.org/10.1186/1471-2105-14-128</a>
</p>
<p>
de Leeuw, C. A., Mooij, J. M., Heskes, T., &amp; Posthuma, D. (2015). MAGMA: generalized gene-set analysis of GWAS data. PLoS computational biology, 11(4), e1004219. <a href="https://doi.org/10.1371/journal.pcbi.1004219">https://doi.org/10.1371/journal.pcbi.1004219</a>
</p>
<p>
Deng, Y., He, T., Fang, R., Li, S., Cao, H., &amp; Cui, Y. (2020). Genome-Wide Gene-Based Multi-Trait Analysis. Frontiers in genetics, 11, 437. <a href="https://doi.org/10.3389/fgene.2020.00437">https://doi.org/10.3389/fgene.2020.00437</a>
</p>
<p>
Dexter F. (2013). Wilcoxon-Mann-Whitney test used for data that are not normally distributed. Anesthesia and analgesia, 117(3), 537–538. <a href="https://doi.org/10.1213/ANE.0b013e31829ed28f">https://doi.org/10.1213/ANE.0b013e31829ed28f</a>
</p>
<p>
Gådin, J. R., van’t Hooft, F. M., Eriksson, P., &amp; Folkersen, L. (2015). AllelicImbalance: an R/bioconductor package for detecting, managing, and visualizing allele expression imbalance data from RNA sequencing. BMC bioinformatics, 16(1), 194. <a href="https://doi.org/10.1186/s12859-015-0620-2">https://doi.org/10.1186/s12859-015-0620-2</a>
</p>
<p>
Gene Ontology Consortium (2015). Gene Ontology Consortium: going forward. Nucleic acids research, 43(Database issue), D1049–D1056. <a href="https://doi.org/10.1093/nar/gku1179">https://doi.org/10.1093/nar/gku1179</a>
</p>
<p>
Hunt, S. E., Moore, B., Amode, R. M., Armean, I. M., Lemos, D., Mushtaq, A., Parton, A., et al.&nbsp;(2022). Annotating and prioritizing genomic variants using the Ensembl Variant Effect Predictor-A tutorial. Human mutation, 43(8), 986–997. <a href="https://doi.org/10.1002/humu.24298">https://doi.org/10.1002/humu.24298</a>
</p>
<p>
Kim, D., Langmead, B., &amp; Salzberg, S. L. (2015). HISAT: a fast spliced aligner with low memory requirements. Nature methods, 12(4), 357–360. <a href="https://doi.org/10.1038/nmeth.3317">https://doi.org/10.1038/nmeth.3317</a>
</p>
<p>
Lee, J., Lee, S., Jang, J. Y., &amp; Park, T. (2018). Exact association test for small size sequencing data. BMC medical genomics, 11(Suppl 2), 30. <a href="https://doi.org/10.1186/s12920-018-0344-z">https://doi.org/10.1186/s12920-018-0344-z</a>
</p>
<p>
Leggett, R. M., Ramirez-Gonzalez, R. H., Clavijo, B. J., Waite, D., &amp; Davey, R. P. (2013). Sequencing quality assessment tools to enable data-driven informatics for high throughput genomics. Frontiers in genetics, 4, 288. <a href="https://doi.org/10.3389/fgene.2013.00288">https://doi.org/10.3389/fgene.2013.00288</a>
</p>
<p>
Li, H., Handsaker, B., Wysoker, A., Fennell, T., Ruan, J., Homer, N., Marth, G., Abecasis, G., Durbin, R., &amp; 1000 Genome Project Data Processing Subgroup (2009). The Sequence Alignment/Map format and SAMtools. Bioinformatics (Oxford, England), 25(16), 2078–2079. <a href="https://doi.org/10.1093/bioinformatics/btp352">https://doi.org/10.1093/bioinformatics/btp352</a>
</p>
<p>
Martens, M., Ammar, A., Riutta, A., Waagmeester, A., Slenter, D. N., Hanspers, K., A Miller, R., Digles, D., Lopes, E. N., Ehrhart, F., Dupuis, L. J., Winckers, L. A., Coort, S. L., Willighagen, E. L., Evelo, C. T., Pico, A. R., &amp; Kutmon, M. (2021). WikiPathways: connecting communities. Nucleic acids research, 49(D1), D613–D621. <a href="https://doi.org/10.1093/nar/gkaa1024">https://doi.org/10.1093/nar/gkaa1024</a>
</p>
<p>
Milacic, M., Beavers, D., Conley, P., Gong, C., Gillespie, M., Griss, J., Haw, R., Jassal, B., Matthews, L., May, B., Petryszak, R., Ragueneau, E., Rothfels, K., Sevilla, C., Shamovsky, V., Stephan, R., Tiwari, K., Varusai, T., Weiser, J., Wright, A., et al.&nbsp;(2024). The Reactome Pathway Knowledgebase 2024. Nucleic acids research, 52(D1), D672–D678. <a href="https://doi.org/10.1093/nar/gkad1025">https://doi.org/10.1093/nar/gkad1025</a>
</p>
<p>
Mullins, N., Forstner, A. J., O’Connell, K. S., Coombes, B., Coleman, J. R. I., Qiao, Z., et al.&nbsp;(2021). Genome-wide association study of more than 40,000 bipolar disorder cases provides new insights into the underlying biology. Nature genetics, 53(6), 817–829. <a href="https://doi.org/10.1038/s41588-021-00857-4">https://doi.org/10.1038/s41588-021-00857-4</a>
</p>
<p>
Pruim, R. J., Welch, R. P., Sanna, S., Teslovich, T. M., Chines, P. S., Gliedt, T. P., Boehnke, M., Abecasis, G. R., &amp; Willer, C. J. (2010). LocusZoom: regional visualization of genome-wide association scan results. Bioinformatics (Oxford, England), 26(18), 2336–2337. <a href="https://doi.org/10.1093/bioinformatics/btq419">https://doi.org/10.1093/bioinformatics/btq419</a>
</p>
<p>
Purcell, S., Neale, B., Todd-Brown, K., Thomas, L., Ferreira, M. A., Bender, D., et al.&nbsp;(2007). PLINK: a tool set for whole-genome association and population-based linkage analyses. American journal of human genetics, 81(3), 559–575. <a href="https://doi.org/10.1086/519795">https://doi.org/10.1086/519795</a>
</p>
<p>
Rentzsch, P., Witten, D., Cooper, G. M., Shendure, J., &amp; Kircher, M. (2019). CADD: predicting the deleteriousness of variants throughout the human genome. Nucleic acids research, 47(D1), D886–D894. <a href="https://doi.org/10.1093/nar/gky1016">https://doi.org/10.1093/nar/gky1016</a>
</p>
<p>
Robinson, J. T., Thorvaldsdóttir, H., Winckler, W., Guttman, M., Lander, E. S., Getz, G., &amp; Mesirov, J. P. (2011). Integrative genomics viewer (IGV). Nature biotechnology, 29(1), 24–26. <a href="https://doi.org/10.1038/nbt.1754">https://doi.org/10.1038/nbt.1754</a>
</p>
<p>
Slifer S. H. (2018). PLINK: Key Functions for Data Analysis. Current protocols in human genetics, 97(1), e59. <a href="https://doi.org/10.1002/cphg.59">https://doi.org/10.1002/cphg.59</a>
</p>
<p>
van de Geijn, B., McVicker, G., Gilad, Y., &amp; Pritchard, J. K. (2015). WASP: allele-specific software for robust molecular quantitative trait locus discovery. Nature methods, 12(11), 1061–1063. <a href="https://doi.org/10.1038/nmeth.3582">https://doi.org/10.1038/nmeth.3582</a>
</p>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>